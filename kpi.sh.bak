#!/bin/bash
source /etc/profile
begin_date=2010-04
end_date=2017-03
mon_p=${begin_date}_${end_date}

spark-sql --master yarn-client --driver-memory 6g --executor-memory 6g --num-executors 20 --executor-cores 1 -e "
  use ipsos;
  set spark.sql.crossJoin.enabled=true;
  add jar /home/ipsos/general/bin/transform-date.jar;
  CREATE TEMPORARY FUNCTION tran_date AS 'TransformDate';
  CREATE TEMPORARY FUNCTION mon_diff AS 'MonDiff';
  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1') location '${mon_p}/kpi_1';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1')
  select ----'1' as kpi,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1') location '${mon_p}/kpi_1';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1')
  select ----'1' as kpi,
  primary_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1') location '${mon_p}/kpi_1';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1')
  select ----'1' as kpi,
  primary_classification,
  second_level_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1') location '${mon_p}/kpi_1';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1')
  select ----'1' as kpi,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1') location '${mon_p}/kpi_1';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1')
  select ----'1' as kpi,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1') location '${mon_p}/kpi_1';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1')
  select ----'1' as kpi,
  primary_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,age_type;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1') location '${mon_p}/kpi_1';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1')
  select ----'1' as kpi,
  primary_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,bn;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1') location '${mon_p}/kpi_1';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1')
  select ----'1' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,age_type;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1') location '${mon_p}/kpi_1';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1')
  select ----'1' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,bn;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_1');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_1') location '${mon_p}/kpi_1_1';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_1')
  select ----'1.1' as kpi,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_1');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_1') location '${mon_p}/kpi_1_1';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_1')
  select ----'1.1' as kpi,
  primary_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_1');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_1') location '${mon_p}/kpi_1_1';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_1')
  select ----'1.1' as kpi,
  primary_classification,
  second_level_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_1');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_1') location '${mon_p}/kpi_1_1';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_1')
  select ----'1.1' as kpi,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_1');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_1') location '${mon_p}/kpi_1_1';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_1')
  select ----'1.1' as kpi,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_1');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_1') location '${mon_p}/kpi_1_1';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_1')
  select ----'1.1' as kpi,
  primary_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,age_type;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_1');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_1') location '${mon_p}/kpi_1_1';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_1')
  select ----'1.1' as kpi,
  primary_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,bn;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_1');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_1') location '${mon_p}/kpi_1_1';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_1')
  select ----'1.1' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,age_type;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_1');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_1') location '${mon_p}/kpi_1_1';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_1')
  select ----'1.1' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,bn;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_11');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_11') location '${mon_p}/kpi_1_11';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_11')
  select ----'1.11' as kpi,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='低端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_11');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_11') location '${mon_p}/kpi_1_11';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_11')
  select ----'1.11' as kpi,
  s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='低端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_11');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_11') location '${mon_p}/kpi_1_11';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_11')
  select ----'1.11' as kpi,
  s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='低端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_11');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_11') location '${mon_p}/kpi_1_11';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_11')
  select ----'1.11' as kpi,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='低端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_11');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_11') location '${mon_p}/kpi_1_11';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_11')
  select ----'1.11' as kpi,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='低端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_11');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_11') location '${mon_p}/kpi_1_11';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_11')
  select ----'1.11' as kpi,
  s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='低端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.age_type;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_11');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_11') location '${mon_p}/kpi_1_11';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_11')
  select ----'1.11' as kpi,
  s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='低端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.bn;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_11');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_11') location '${mon_p}/kpi_1_11';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_11')
  select ----'1.11' as kpi,
  s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='低端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification,s.age_type;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_11');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_11') location '${mon_p}/kpi_1_11';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_11')
  select ----'1.11' as kpi,
  s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='低端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification,s.bn;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_12');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_12') location '${mon_p}/kpi_1_12';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_12')
  select ----'1.12' as kpi,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='中端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_12');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_12') location '${mon_p}/kpi_1_12';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_12')
  select ----'1.12' as kpi,
  s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='中端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_12');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_12') location '${mon_p}/kpi_1_12';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_12')
  select ----'1.12' as kpi,
  s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='中端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_12');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_12') location '${mon_p}/kpi_1_12';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_12')
  select ----'1.12' as kpi,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='中端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_12');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_12') location '${mon_p}/kpi_1_12';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_12')
  select ----'1.12' as kpi,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='中端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_12');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_12') location '${mon_p}/kpi_1_12';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_12')
  select ----'1.12' as kpi,
  s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='中端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.age_type;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_12');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_12') location '${mon_p}/kpi_1_12';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_12')
  select ----'1.12' as kpi,
  s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='中端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.bn;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_12');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_12') location '${mon_p}/kpi_1_12';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_12')
  select ----'1.12' as kpi,
  s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='中端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification,s.age_type;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_12');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_12') location '${mon_p}/kpi_1_12';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_12')
  select ----'1.12' as kpi,
  s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='中端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification,s.bn;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_13');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_13') location '${mon_p}/kpi_1_13';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_13')
  select ----'1.13' as kpi,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='高端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_13');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_13') location '${mon_p}/kpi_1_13';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_13')
  select ----'1.13' as kpi,
  s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='高端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_13');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_13') location '${mon_p}/kpi_1_13';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_13')
  select ----'1.13' as kpi,
  s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='高端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_13');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_13') location '${mon_p}/kpi_1_13';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_13')
  select ----'1.13' as kpi,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='高端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_13');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_13') location '${mon_p}/kpi_1_13';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_13')
  select ----'1.13' as kpi,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='高端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_13');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_13') location '${mon_p}/kpi_1_13';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_13')
  select ----'1.13' as kpi,
  s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='高端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.age_type;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_13');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_13') location '${mon_p}/kpi_1_13';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_13')
  select ----'1.13' as kpi,
  s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='高端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.bn;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_13');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_13') location '${mon_p}/kpi_1_13';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_13')
  select ----'1.13' as kpi,
  s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='高端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification,s.age_type;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_13');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_13') location '${mon_p}/kpi_1_13';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_13')
  select ----'1.13' as kpi,
  s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  count(distinct s.vin,tran_date(s.order_balance_date)) as cnt,
  s.asc_code
   from label_order s,part t,engine_oil m
  where s.MAINT_TYPE1='保养'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and t.part_number=m.part_num
  and m.type='高端'
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification,s.bn;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_14');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_14') location '${mon_p}/kpi_1_14';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_14')
  select ----'1.14' as kpi,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_total_chev_final 
  where kpi='kpi_1_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_total_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon ;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_14');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_14') location '${mon_p}/kpi_1_14';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_14')
  select ----'1.14' as kpi,
   s.a_level,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_level_chev_final 
  where kpi='kpi_1_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_level_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level ;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_14');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_14') location '${mon_p}/kpi_1_14';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_14')
  select ----'1.14' as kpi,
   s.a_level,
   s.b_level,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_level_chev_final 
  where kpi='kpi_1_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_level_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level 
    and s.b_level=t.b_level;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_14');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_14') location '${mon_p}/kpi_1_14';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_14')
  select ----'1.14' as kpi,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_agetype_chev_final 
  where kpi='kpi_1_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.age_type=t.age_type ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_14');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_14') location '${mon_p}/kpi_1_14';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_14')
  select ----'1.14' as kpi,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_bnbw_chev_final 
  where kpi='kpi_1_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.bnbw=t.bnbw ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_14');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_14') location '${mon_p}/kpi_1_14';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_14')
  select ----'1.14' as kpi,
   s.a_level,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_agetype_chev_final 
  where kpi='kpi_1_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.age_type=t.age_type ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_14');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_14') location '${mon_p}/kpi_1_14';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_14')
  select ----'1.14' as kpi,
   s.a_level,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_bnbw_chev_final 
  where kpi='kpi_1_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.bnbw=t.bnbw ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_14');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_14') location '${mon_p}/kpi_1_14';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_14')
  select ----'1.14' as kpi,
   s.a_level,
   s.b_level,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_agetype_chev_final 
  where kpi='kpi_1_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.b_level=t.b_level
    and s.age_type=t.age_type ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_14');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_14') location '${mon_p}/kpi_1_14';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_14')
  select ----'1.14' as kpi,
   s.a_level,
   s.b_level,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_bnbw_chev_final 
  where kpi='kpi_1_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.b_level=t.b_level
    and s.bnbw=t.bnbw ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_2');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_2') location '${mon_p}/kpi_1_2';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_2')
  select ----'1.2' as kpi,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_2');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_2') location '${mon_p}/kpi_1_2';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_2')
  select ----'1.2' as kpi,
  primary_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_2');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_2') location '${mon_p}/kpi_1_2';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_2')
  select ----'1.2' as kpi,
  primary_classification,
  second_level_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_2');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_2') location '${mon_p}/kpi_1_2';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_2')
  select ----'1.2' as kpi,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_2');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_2') location '${mon_p}/kpi_1_2';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_2')
  select ----'1.2' as kpi,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_2');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_2') location '${mon_p}/kpi_1_2';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_2')
  select ----'1.2' as kpi,
  primary_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,age_type;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_2');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_2') location '${mon_p}/kpi_1_2';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_2')
  select ----'1.2' as kpi,
  primary_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,bn;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_2');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_2') location '${mon_p}/kpi_1_2';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_2')
  select ----'1.2' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,age_type;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_2');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_2') location '${mon_p}/kpi_1_2';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_2')
  select ----'1.2' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,bn;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_21');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_21') location '${mon_p}/kpi_1_21';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_21')
  select ----'1.21' as kpi,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_total_chev_final 
  where kpi='kpi_1_2'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_total_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon ;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_21');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_21') location '${mon_p}/kpi_1_21';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_21')
  select ----'1.21' as kpi,
   s.a_level,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_level_chev_final 
  where kpi='kpi_1_2'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_level_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level ;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_21');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_21') location '${mon_p}/kpi_1_21';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_21')
  select ----'1.21' as kpi,
   s.a_level,
   s.b_level,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_level_chev_final 
  where kpi='kpi_1_2'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_level_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level 
    and s.b_level=t.b_level;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_21');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_21') location '${mon_p}/kpi_1_21';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_21')
  select ----'1.21' as kpi,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_agetype_chev_final 
  where kpi='kpi_1_2'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.age_type=t.age_type ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_21');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_21') location '${mon_p}/kpi_1_21';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_21')
  select ----'1.21' as kpi,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_bnbw_chev_final 
  where kpi='kpi_1_2'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.bnbw=t.bnbw ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_21');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_21') location '${mon_p}/kpi_1_21';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_21')
  select ----'1.21' as kpi,
   s.a_level,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_agetype_chev_final 
  where kpi='kpi_1_2'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.age_type=t.age_type ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_21');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_21') location '${mon_p}/kpi_1_21';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_21')
  select ----'1.21' as kpi,
   s.a_level,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_bnbw_chev_final 
  where kpi='kpi_1_2'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.bnbw=t.bnbw ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_21');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_21') location '${mon_p}/kpi_1_21';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_21')
  select ----'1.21' as kpi,
   s.a_level,
   s.b_level,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_agetype_chev_final 
  where kpi='kpi_1_2'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.b_level=t.b_level
    and s.age_type=t.age_type ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_21');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_21') location '${mon_p}/kpi_1_21';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_21')
  select ----'1.21' as kpi,
   s.a_level,
   s.b_level,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_bnbw_chev_final 
  where kpi='kpi_1_2'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.b_level=t.b_level
    and s.bnbw=t.bnbw ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_3');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_3') location '${mon_p}/kpi_1_3';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_3')
  select ----'1.3' as kpi,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_3');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_3') location '${mon_p}/kpi_1_3';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_3')
  select ----'1.3' as kpi,
  primary_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_3');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_3') location '${mon_p}/kpi_1_3';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_3')
  select ----'1.3' as kpi,
  primary_classification,
  second_level_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_3');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_3') location '${mon_p}/kpi_1_3';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_3')
  select ----'1.3' as kpi,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_3');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_3') location '${mon_p}/kpi_1_3';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_3')
  select ----'1.3' as kpi,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_3');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_3') location '${mon_p}/kpi_1_3';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_3')
  select ----'1.3' as kpi,
  primary_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,age_type;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_3');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_3') location '${mon_p}/kpi_1_3';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_3')
  select ----'1.3' as kpi,
  primary_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,bn;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_3');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_3') location '${mon_p}/kpi_1_3';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_3')
  select ----'1.3' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,age_type;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_3');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_3') location '${mon_p}/kpi_1_3';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_3')
  select ----'1.3' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,bn;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_31');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_31') location '${mon_p}/kpi_1_31';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_31')
  select ----'1.31' as kpi,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin
      ) s 
  where sumamount<800
  group by substr(order_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_31');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_31') location '${mon_p}/kpi_1_31';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_31')
  select ----'1.31' as kpi,
  primary_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification) s 
  where sumamount<800
  group by substr(order_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_31');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_31') location '${mon_p}/kpi_1_31';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_31')
  select ----'1.31' as kpi,
  primary_classification,
  second_level_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification,second_level_classification) s 
  where sumamount<800
  group by substr(order_date,1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_31');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_31') location '${mon_p}/kpi_1_31';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_31')
  select ----'1.31' as kpi,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type) s 
  where sumamount<800
  group by substr(order_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_31');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_31') location '${mon_p}/kpi_1_31';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_31')
  select ----'1.31' as kpi,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn) s 
  where sumamount<800
  group by substr(order_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_31');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_31') location '${mon_p}/kpi_1_31';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_31')
  select ----'1.31' as kpi,
  primary_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification) s 
  where sumamount<800
  group by substr(order_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_31');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_31') location '${mon_p}/kpi_1_31';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_31')
  select ----'1.31' as kpi,
  primary_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification) s 
  where sumamount<800
  group by substr(order_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_31');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_31') location '${mon_p}/kpi_1_31';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_31')
  select ----'1.31' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification,second_level_classification) s 
  where sumamount<800
  group by substr(order_date,1,7),asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_31');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_31') location '${mon_p}/kpi_1_31';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_31')
  select ----'1.31' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification,second_level_classification) s 
  where sumamount<800
  group by substr(order_date,1,7),asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_32');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_32') location '${mon_p}/kpi_1_32';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_32')
  select ----'1.32' as kpi,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin
      ) s 
  where sumamount>=800 and sumamount<2000 
  group by substr(order_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_32');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_32') location '${mon_p}/kpi_1_32';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_32')
  select ----'1.32' as kpi,
  primary_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification) s 
  where sumamount>=800 and sumamount<2000 
  group by substr(order_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_32');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_32') location '${mon_p}/kpi_1_32';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_32')
  select ----'1.32' as kpi,
  primary_classification,
  second_level_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification,second_level_classification) s 
  where sumamount>=800 and sumamount<2000 
  group by substr(order_date,1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_32');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_32') location '${mon_p}/kpi_1_32';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_32')
  select ----'1.32' as kpi,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type) s 
  where sumamount>=800 and sumamount<2000 
  group by substr(order_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_32');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_32') location '${mon_p}/kpi_1_32';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_32')
  select ----'1.32' as kpi,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn) s 
  where sumamount>=800 and sumamount<2000 
  group by substr(order_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_32');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_32') location '${mon_p}/kpi_1_32';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_32')
  select ----'1.32' as kpi,
  primary_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification) s 
  where sumamount>=800 and sumamount<2000 
  group by substr(order_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_32');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_32') location '${mon_p}/kpi_1_32';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_32')
  select ----'1.32' as kpi,
  primary_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification) s 
  where sumamount>=800 and sumamount<2000 
  group by substr(order_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_32');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_32') location '${mon_p}/kpi_1_32';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_32')
  select ----'1.32' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification,second_level_classification) s 
  where sumamount>=800 and sumamount<2000 
  group by substr(order_date,1,7),asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_32');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_32') location '${mon_p}/kpi_1_32';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_32')
  select ----'1.32' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification,second_level_classification) s 
  where sumamount>=800 and sumamount<2000 
  group by substr(order_date,1,7),asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_33');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_33') location '${mon_p}/kpi_1_33';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_33')
  select ----'1.33' as kpi,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin
      ) s 
  where sumamount>=2000 and sumamount<5000 
  group by substr(order_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_33');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_33') location '${mon_p}/kpi_1_33';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_33')
  select ----'1.33' as kpi,
  primary_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification) s 
  where sumamount>=2000 and sumamount<5000 
  group by substr(order_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_33');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_33') location '${mon_p}/kpi_1_33';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_33')
  select ----'1.33' as kpi,
  primary_classification,
  second_level_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification,second_level_classification) s 
  where sumamount>=2000 and sumamount<5000 
  group by substr(order_date,1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_33');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_33') location '${mon_p}/kpi_1_33';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_33')
  select ----'1.33' as kpi,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type) s 
  where sumamount>=2000 and sumamount<5000 
  group by substr(order_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_33');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_33') location '${mon_p}/kpi_1_33';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_33')
  select ----'1.33' as kpi,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn) s 
  where sumamount>=2000 and sumamount<5000 
  group by substr(order_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_33');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_33') location '${mon_p}/kpi_1_33';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_33')
  select ----'1.33' as kpi,
  primary_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification) s 
  where sumamount>=2000 and sumamount<5000 
  group by substr(order_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_33');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_33') location '${mon_p}/kpi_1_33';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_33')
  select ----'1.33' as kpi,
  primary_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification) s 
  where sumamount>=2000 and sumamount<5000 
  group by substr(order_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_33');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_33') location '${mon_p}/kpi_1_33';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_33')
  select ----'1.33' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification,second_level_classification) s 
  where sumamount>=2000 and sumamount<5000 
  group by substr(order_date,1,7),asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_33');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_33') location '${mon_p}/kpi_1_33';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_33')
  select ----'1.33' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification,second_level_classification) s 
  where sumamount>=2000 and sumamount<5000 
  group by substr(order_date,1,7),asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_34');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_34') location '${mon_p}/kpi_1_34';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_34')
  select ----'1.34' as kpi,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin
      ) s 
  where sumamount>=5000 and sumamount<10000 
  group by substr(order_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_34');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_34') location '${mon_p}/kpi_1_34';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_34')
  select ----'1.34' as kpi,
  primary_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification) s 
  where sumamount>=5000 and sumamount<10000 
  group by substr(order_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_34');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_34') location '${mon_p}/kpi_1_34';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_34')
  select ----'1.34' as kpi,
  primary_classification,
  second_level_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification,second_level_classification) s 
  where sumamount>=5000 and sumamount<10000 
  group by substr(order_date,1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_34');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_34') location '${mon_p}/kpi_1_34';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_34')
  select ----'1.34' as kpi,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type) s 
  where sumamount>=5000 and sumamount<10000 
  group by substr(order_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_34');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_34') location '${mon_p}/kpi_1_34';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_34')
  select ----'1.34' as kpi,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn) s 
  where sumamount>=5000 and sumamount<10000 
  group by substr(order_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_34');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_34') location '${mon_p}/kpi_1_34';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_34')
  select ----'1.34' as kpi,
  primary_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification) s 
  where sumamount>=5000 and sumamount<10000 
  group by substr(order_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_34');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_34') location '${mon_p}/kpi_1_34';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_34')
  select ----'1.34' as kpi,
  primary_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification) s 
  where sumamount>=5000 and sumamount<10000 
  group by substr(order_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_34');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_34') location '${mon_p}/kpi_1_34';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_34')
  select ----'1.34' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification,second_level_classification) s 
  where sumamount>=5000 and sumamount<10000 
  group by substr(order_date,1,7),asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_34');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_34') location '${mon_p}/kpi_1_34';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_34')
  select ----'1.34' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification,second_level_classification) s 
  where sumamount>=5000 and sumamount<10000 
  group by substr(order_date,1,7),asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_35');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_35') location '${mon_p}/kpi_1_35';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_35')
  select ----'1.35' as kpi,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin
      ) s 
  where sumamount>=10000 
  group by substr(order_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_35');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_35') location '${mon_p}/kpi_1_35';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_35')
  select ----'1.35' as kpi,
  primary_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification) s 
  where sumamount>=10000 
  group by substr(order_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_35');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_35') location '${mon_p}/kpi_1_35';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_35')
  select ----'1.35' as kpi,
  primary_classification,
  second_level_classification,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,primary_classification,second_level_classification) s 
  where sumamount>=10000 
  group by substr(order_date,1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_35');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_35') location '${mon_p}/kpi_1_35';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_35')
  select ----'1.35' as kpi,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type) s 
  where sumamount>=10000 
  group by substr(order_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_35');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_35') location '${mon_p}/kpi_1_35';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_35')
  select ----'1.35' as kpi,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn) s 
  where sumamount>=10000 
  group by substr(order_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_35');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_35') location '${mon_p}/kpi_1_35';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_35')
  select ----'1.35' as kpi,
  primary_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification) s 
  where sumamount>=10000 
  group by substr(order_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_35');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_35') location '${mon_p}/kpi_1_35';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_35')
  select ----'1.35' as kpi,
  primary_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification) s 
  where sumamount>=10000 
  group by substr(order_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_35');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_35') location '${mon_p}/kpi_1_35';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_35')
  select ----'1.35' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   age_type,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,age_type,primary_classification,second_level_classification) s 
  where sumamount>=10000 
  group by substr(order_date,1,7),asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_35');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_35') location '${mon_p}/kpi_1_35';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_35')
  select ----'1.35' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(order_date,1,7) as mon,
  count(*) as cnt,
  asc_code
   from (
   select asc_code,
   primary_classification,
   second_level_classification,
   bn,
   tran_date(order_balance_date) as order_date,
   vin,
   sum(order_balance_amount) as sumamount  
   from label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by asc_code,tran_date(order_balance_date),vin,bn,primary_classification,second_level_classification) s 
  where sumamount>=10000 
  group by substr(order_date,1,7),asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_36');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_36') location '${mon_p}/kpi_1_36';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_36')
  select ----'1.36' as kpi,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_total_chev_final 
  where kpi='kpi_1_3'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_total_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon ;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_36');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_36') location '${mon_p}/kpi_1_36';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_36')
  select ----'1.36' as kpi,
   s.a_level,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_level_chev_final 
  where kpi='kpi_1_3'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_level_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level ;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_36');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_36') location '${mon_p}/kpi_1_36';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_36')
  select ----'1.36' as kpi,
   s.a_level,
   s.b_level,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_level_chev_final 
  where kpi='kpi_1_3'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_level_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level 
    and s.b_level=t.b_level;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_36');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_36') location '${mon_p}/kpi_1_36';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_36')
  select ----'1.36' as kpi,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_agetype_chev_final 
  where kpi='kpi_1_3'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.age_type=t.age_type ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_36');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_36') location '${mon_p}/kpi_1_36';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_36')
  select ----'1.36' as kpi,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_bnbw_chev_final 
  where kpi='kpi_1_3'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.bnbw=t.bnbw ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_36');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_36') location '${mon_p}/kpi_1_36';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_36')
  select ----'1.36' as kpi,
   s.a_level,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_agetype_chev_final 
  where kpi='kpi_1_3'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.age_type=t.age_type ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_36');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_36') location '${mon_p}/kpi_1_36';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_36')
  select ----'1.36' as kpi,
   s.a_level,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_bnbw_chev_final 
  where kpi='kpi_1_3'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.bnbw=t.bnbw ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_36');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_36') location '${mon_p}/kpi_1_36';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_36')
  select ----'1.36' as kpi,
   s.a_level,
   s.b_level,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_agetype_chev_final 
  where kpi='kpi_1_3'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.b_level=t.b_level
    and s.age_type=t.age_type ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_36');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_36') location '${mon_p}/kpi_1_36';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_36')
  select ----'1.36' as kpi,
   s.a_level,
   s.b_level,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_bnbw_chev_final 
  where kpi='kpi_1_3'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.b_level=t.b_level
    and s.bnbw=t.bnbw ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_4');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_4') location '${mon_p}/kpi_1_4';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_4')
  select ----'1.4' as kpi,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_4');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_4') location '${mon_p}/kpi_1_4';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_4')
  select ----'1.4' as kpi,
  primary_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_4');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_4') location '${mon_p}/kpi_1_4';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_4')
  select ----'1.4' as kpi,
  primary_classification,
  second_level_classification,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_4');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_4') location '${mon_p}/kpi_1_4';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_4')
  select ----'1.4' as kpi,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_4');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_4') location '${mon_p}/kpi_1_4';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_4')
  select ----'1.4' as kpi,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_4');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_4') location '${mon_p}/kpi_1_4';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_4')
  select ----'1.4' as kpi,
  primary_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,age_type;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_4');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_4') location '${mon_p}/kpi_1_4';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_4')
  select ----'1.4' as kpi,
  primary_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,bn;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_4');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_4') location '${mon_p}/kpi_1_4';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_4')
  select ----'1.4' as kpi,
  primary_classification,
  second_level_classification,
  age_type,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,age_type;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_4');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_4') location '${mon_p}/kpi_1_4';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_4')
  select ----'1.4' as kpi,
  primary_classification,
  second_level_classification,
  bn,
  substr(tran_date(order_balance_date),1,7) as mon,
  count(distinct vin,tran_date(order_balance_date)) as cnt,
  asc_code
   from label_order  
  where claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification,bn;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_41');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_41') location '${mon_p}/kpi_1_41';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_41')
  select ----'1.41' as kpi,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_total_chev_final 
  where kpi='kpi_1_4'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_total_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon ;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_41');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_41') location '${mon_p}/kpi_1_41';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_41')
  select ----'1.41' as kpi,
   s.a_level,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_level_chev_final 
  where kpi='kpi_1_4'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_level_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level ;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_41');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_41') location '${mon_p}/kpi_1_41';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_41')
  select ----'1.41' as kpi,
   s.a_level,
   s.b_level,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_level_chev_final 
  where kpi='kpi_1_4'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_level_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level 
    and s.b_level=t.b_level;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_41');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_41') location '${mon_p}/kpi_1_41';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_41')
  select ----'1.41' as kpi,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_agetype_chev_final 
  where kpi='kpi_1_4'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.age_type=t.age_type ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_41');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_41') location '${mon_p}/kpi_1_41';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_41')
  select ----'1.41' as kpi,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_bnbw_chev_final 
  where kpi='kpi_1_4'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.bnbw=t.bnbw ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_41');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_41') location '${mon_p}/kpi_1_41';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_41')
  select ----'1.41' as kpi,
   s.a_level,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_agetype_chev_final 
  where kpi='kpi_1_4'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.age_type=t.age_type ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_41');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_41') location '${mon_p}/kpi_1_41';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_41')
  select ----'1.41' as kpi,
   s.a_level,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_a_bnbw_chev_final 
  where kpi='kpi_1_4'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_a_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.bnbw=t.bnbw ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_41');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_41') location '${mon_p}/kpi_1_41';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_41')
  select ----'1.41' as kpi,
   s.a_level,
   s.b_level,
   s.age_type,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_agetype_chev_final 
  where kpi='kpi_1_4'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_agetype_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.b_level=t.b_level
    and s.age_type=t.age_type ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_1_41');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_1_41') location '${mon_p}/kpi_1_41';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_1_41')
  select ----'1.41' as kpi,
   s.a_level,
   s.b_level,
   s.bnbw,
   s.mon,
   s.num/t.num as num,
   s.asc_code
  from (
  select * from kpi_b_bnbw_chev_final 
  where kpi='kpi_1_4'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) s,(
  select * from kpi_b_bnbw_chev_final 
  where kpi='kpi_1'
    and mon>='${begin_date}'
    and mon<='${end_date}'
   ) t 
  where s.asc_code=t.asc_code
    and s.mon=t.mon 
    and s.a_level=t.a_level
    and s.b_level=t.b_level
    and s.bnbw=t.bnbw ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2') location '${mon_p}/kpi_2';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_2')
  select substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2') location '${mon_p}/kpi_2';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2')
  select primary_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2') location '${mon_p}/kpi_2';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2')
  select primary_classification,
   second_level_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2') location '${mon_p}/kpi_2';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2') location '${mon_p}/kpi_2';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2') location '${mon_p}/kpi_2';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2')
  select primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2') location '${mon_p}/kpi_2';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2')
  select primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2') location '${mon_p}/kpi_2';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2')
  select primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2') location '${mon_p}/kpi_2';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2')
  select primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_1');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_1') location '${mon_p}/kpi_2_1';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_1')
  select substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_1');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_1') location '${mon_p}/kpi_2_1';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_1')
  select primary_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_1');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_1') location '${mon_p}/kpi_2_1';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_1')
  select primary_classification,
   second_level_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_1');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_1') location '${mon_p}/kpi_2_1';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_1')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_1');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_1') location '${mon_p}/kpi_2_1';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_1')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_1');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_1') location '${mon_p}/kpi_2_1';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_1')
  select primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_1');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_1') location '${mon_p}/kpi_2_1';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_1')
  select primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_1');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_1') location '${mon_p}/kpi_2_1';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_1')
  select primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_1');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_1') location '${mon_p}/kpi_2_1';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_1')
  select primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_2');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_2') location '${mon_p}/kpi_2_2';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_2')
  select substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_2');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_2') location '${mon_p}/kpi_2_2';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_2')
  select primary_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_2');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_2') location '${mon_p}/kpi_2_2';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_2')
  select primary_classification,
   second_level_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_2');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_2') location '${mon_p}/kpi_2_2';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_2')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_2');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_2') location '${mon_p}/kpi_2_2';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_2')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_2');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_2') location '${mon_p}/kpi_2_2';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_2')
  select primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_2');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_2') location '${mon_p}/kpi_2_2';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_2')
  select primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_2');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_2') location '${mon_p}/kpi_2_2';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_2')
  select primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_2');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_2') location '${mon_p}/kpi_2_2';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_2')
  select primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_3');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_3') location '${mon_p}/kpi_2_3';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_3')
  select substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_3');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_3') location '${mon_p}/kpi_2_3';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_3')
  select primary_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_3');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_3') location '${mon_p}/kpi_2_3';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_3')
  select primary_classification,
   second_level_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_3');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_3') location '${mon_p}/kpi_2_3';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_3')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_3');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_3') location '${mon_p}/kpi_2_3';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_3')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_3');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_3') location '${mon_p}/kpi_2_3';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_3')
  select primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_3');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_3') location '${mon_p}/kpi_2_3';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_3')
  select primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_3');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_3') location '${mon_p}/kpi_2_3';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_3')
  select primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_3');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_3') location '${mon_p}/kpi_2_3';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_3')
  select primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin,tran_date(s.order_balance_date))/count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
      when s.outdate<'2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>23 then '保外'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
      when s.outdate>='2013-10-01' 
      and mon_diff(t.mon_label,s.outdate)>35 then '保外'
      else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_4');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_4') location '${mon_p}/kpi_2_4';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_4')
  select substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_4');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_4') location '${mon_p}/kpi_2_4';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_4')
  select primary_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_4');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_4') location '${mon_p}/kpi_2_4';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_4')
  select primary_classification,
   second_level_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_4');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_4') location '${mon_p}/kpi_2_4';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_4')
  select case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_4');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_4') location '${mon_p}/kpi_2_4';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_4')
  select case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_4');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_4') location '${mon_p}/kpi_2_4';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_4')
  select primary_classification,
   case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_4');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_4') location '${mon_p}/kpi_2_4';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_4')
  select primary_classification,
   case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_4');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_4') location '${mon_p}/kpi_2_4';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_4')
  select primary_classification,
   second_level_classification,
   case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_4');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_4') location '${mon_p}/kpi_2_4';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_4')
  select primary_classification,
   second_level_classification,
   case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-59),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_41');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_41') location '${mon_p}/kpi_2_41';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_41')
  select mon,
  num*12/(case when yc<=60 then yc else 60 end) as num,
  asc_code
  from (
  select s.mon,
  mon_diff(concat(s.mon,'-01'),concat(t.minmon,'-01'))+1 as yc,
  s.num,
  s.asc_code
  from kpi_total_chev_final s ,
  (
  select min(mon) as minmon,asc_code from kpi_total_chev_final
  where kpi='kpi_2_4'
  group by asc_code
  ) t where s.asc_code=t.asc_code and s.kpi='kpi_2_4' and s.mon>='${begin_date}'
    and s.mon<='${end_date}'
  ) s ;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_41');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_41') location '${mon_p}/kpi_2_41';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_41')
  select a_level,
  mon,
  num*12/(case when yc<=60 then yc else 60 end) as num,
  asc_code
  from (
  select s.a_level,s.mon,
  mon_diff(concat(s.mon,'-01'),concat(t.minmon,'-01'))+1 as yc,
  s.num,
  s.asc_code
  from kpi_a_level_chev_final s ,
  (
  select min(mon) as minmon,asc_code,a_level from kpi_a_level_chev_final
  where kpi='kpi_2_4'
  group by asc_code,a_level
  ) t where s.asc_code=t.asc_code and s.kpi='kpi_2_4' and s.a_level=t.a_level and s.mon>='${begin_date}'
    and s.mon<='${end_date}'
  ) s ;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_41');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_41') location '${mon_p}/kpi_2_41';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_41')
  select a_level,
  b_level,
  mon,
  num*12/(case when yc<=60 then yc else 60 end) as num,
  asc_code
  from (
  select s.a_level,s.b_level,s.mon,
  mon_diff(concat(s.mon,'-01'),concat(t.minmon,'-01'))+1 as yc,
  s.num,
  s.asc_code
  from kpi_b_level_chev_final s ,
  (
  select min(mon) as minmon,asc_code,a_level,b_level from kpi_b_level_chev_final
  where kpi='kpi_2_4'
  group by asc_code,a_level,b_level
  ) t where s.asc_code=t.asc_code and s.kpi='kpi_2_4' and s.a_level=t.a_level and s.b_level=t.b_level
  and s.mon>='${begin_date}'
    and s.mon<='${end_date}'
  ) s ;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_41');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_41') location '${mon_p}/kpi_2_41';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_41')
  select age_type,
  mon,
  num*12/(case when yc<=60 then yc else 60 end) as num,
  asc_code
  from (
  select s.age_type,s.mon,
  mon_diff(concat(s.mon,'-01'),concat(t.minmon,'-01'))+1 as yc,
  s.num,
  s.asc_code
  from kpi_agetype_chev_final s ,
  (
  select min(mon) as minmon,asc_code,age_type from kpi_agetype_chev_final
  where kpi='kpi_2_4'
  group by asc_code,age_type
  ) t where s.asc_code=t.asc_code and s.kpi='kpi_2_4' and s.age_type=t.age_type
  and s.mon>='${begin_date}'
    and s.mon<='${end_date}'
  ) s ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_41');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_41') location '${mon_p}/kpi_2_41';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_41')
  select bnbw,
  mon,
  num*12/(case when yc<=60 then yc else 60 end) as num,
  asc_code
  from (
  select s.bnbw,s.mon,
  mon_diff(concat(s.mon,'-01'),concat(t.minmon,'-01'))+1 as yc,
  s.num,
  s.asc_code
  from kpi_bnbw_chev_final s ,
  (
  select min(mon) as minmon,asc_code,bnbw from kpi_bnbw_chev_final
  where kpi='kpi_2_4'
  group by asc_code,bnbw
  ) t where s.asc_code=t.asc_code and s.kpi='kpi_2_4' and s.bnbw=t.bnbw
  and s.mon>='${begin_date}'
    and s.mon<='${end_date}'
  ) s ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_41');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_41') location '${mon_p}/kpi_2_41';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_41')
  select a_level,
  age_type,
  mon,
  num*12/(case when yc<=60 then yc else 60 end) as num,
  asc_code
  from (
  select s.a_level,s.age_type,s.mon,
  mon_diff(concat(s.mon,'-01'),concat(t.minmon,'-01'))+1 as yc,
  s.num,
  s.asc_code
  from kpi_a_agetype_chev_final s ,
  (
  select min(mon) as minmon,asc_code,a_level,age_type from kpi_a_agetype_chev_final
  where kpi='kpi_2_4'
  group by asc_code,a_level,age_type
  ) t where s.asc_code=t.asc_code and s.kpi='kpi_2_4' and s.a_level=t.a_level and s.age_type=t.age_type
  and s.mon>='${begin_date}'
    and s.mon<='${end_date}'
  ) s ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_41');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_41') location '${mon_p}/kpi_2_41';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_41')
  select a_level,
  bnbw,
  mon,
  num*12/(case when yc<=60 then yc else 60 end) as num,
  asc_code
  from (
  select s.a_level,s.bnbw,s.mon,
  mon_diff(concat(s.mon,'-01'),concat(t.minmon,'-01'))+1 as yc,
  s.num,
  s.asc_code
  from kpi_a_bnbw_chev_final s ,
  (
  select min(mon) as minmon,asc_code,a_level,bnbw from kpi_a_bnbw_chev_final
  where kpi='kpi_2_4'
  group by asc_code,a_level,bnbw
  ) t where s.asc_code=t.asc_code and s.kpi='kpi_2_4' and s.a_level=t.a_level and s.bnbw=t.bnbw
  and s.mon>='${begin_date}'
    and s.mon<='${end_date}'
  ) s ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_41');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_41') location '${mon_p}/kpi_2_41';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_41')
  select a_level,
  b_level,
  age_type,
  mon,
  num*12/(case when yc<=60 then yc else 60 end) as num,
  asc_code
  from (
  select s.a_level,s.b_level,s.age_type,s.mon,
  mon_diff(concat(s.mon,'-01'),concat(t.minmon,'-01'))+1 as yc,
  s.num,
  s.asc_code
  from kpi_b_agetype_chev_final s ,
  (
  select min(mon) as minmon,asc_code,a_level,b_level,age_type from kpi_b_agetype_chev_final
  where kpi='kpi_2_4'
  group by asc_code,a_level,age_type,b_level
  ) t where s.asc_code=t.asc_code and s.kpi='kpi_2_4' and s.a_level=t.a_level and s.age_type=t.age_type
  and s.mon>='${begin_date}'
    and s.mon<='${end_date}'
  and s.b_level=t.b_level
  ) s ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_41');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_41') location '${mon_p}/kpi_2_41';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_41')
  select a_level,
  b_level,
  bnbw,
  mon,
  num*12/(case when yc<=60 then yc else 60 end) as num,
  asc_code
  from (
  select s.a_level,s.b_level,s.bnbw,s.mon,
  mon_diff(concat(s.mon,'-01'),concat(t.minmon,'-01'))+1 as yc,
  s.num,
  s.asc_code
  from kpi_b_bnbw_chev_final s ,
  (
  select min(mon) as minmon,asc_code,a_level,b_level,bnbw from kpi_b_bnbw_chev_final
  where kpi='kpi_2_4'
  group by asc_code,a_level,bnbw,b_level
  ) t where s.asc_code=t.asc_code and s.kpi='kpi_2_4' and s.a_level=t.a_level and s.bnbw=t.bnbw
  and s.b_level=t.b_level
  and s.mon>='${begin_date}'
    and s.mon<='${end_date}'
  ) s ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_42');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_42') location '${mon_p}/kpi_2_42';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_42')
  select substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_42');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_42') location '${mon_p}/kpi_2_42';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_42')
  select primary_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_42');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_42') location '${mon_p}/kpi_2_42';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_42')
  select primary_classification,
   second_level_classification,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_42');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_42') location '${mon_p}/kpi_2_42';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_42')
  select case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_42');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_42') location '${mon_p}/kpi_2_42';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_42')
  select case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_42');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_42') location '${mon_p}/kpi_2_42';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_42')
  select primary_classification,
   case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_42');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_42') location '${mon_p}/kpi_2_42';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_42')
  select primary_classification,
   case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_42');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_42') location '${mon_p}/kpi_2_42';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_42')
  select primary_classification,
   second_level_classification,
   case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as agetype,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_2_42');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_2_42') location '${mon_p}/kpi_2_42';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_2_42')
  select primary_classification,
   second_level_classification,
   case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end as bn,
   substr(t.mon_label,1,7) as mon,
   count(distinct s.vin) as num,
   s.asc_code
   from date_label t,label_doss s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>'' and s.asc_code<>''
    group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
      when tran_date(s.invoice_date)<'2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
      when tran_date(s.invoice_date)>='2013-10-01' 
      and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
      else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3') location '${mon_p}/kpi_3';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3')
   select s.mon,
   s.cnt/t.num as num,
   s.asc_code
   from (
   select s.asc_code,s.mon,count(*) as cnt from ( 
    select s.asc_code,
    s.vin,
    substr(t.mon_label,1,7) as mon,
    count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end) 
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by s.asc_code,
    s.vin,
    substr(t.mon_label,1,7)
    having count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end)>=2
    ) s group by s.asc_code,s.mon
    ) s ,
    (select * from kpi_total_chev_final where kpi='kpi_2_2') t
    where s.asc_code=t.asc_code and s.mon=t.mon;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3') location '${mon_p}/kpi_3';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3')
  select s.primary_classification,
   s.mon,
   s.cnt/t.num as num,
   s.asc_code
   from (
   select s.asc_code,s.primary_classification,s.mon,count(*) as cnt from 
   ( 
    select s.asc_code,
    s.primary_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon,
    count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end) 
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by s.asc_code,
    s.vin,
    substr(t.mon_label,1,7),
    s.primary_classification
    having count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end)>=2
    ) s group by s.asc_code,s.mon,primary_classification
    ) s ,
    (select * from kpi_a_level_chev_final where kpi='kpi_2_2') t
    where s.asc_code=t.asc_code and s.mon=t.mon and s.primary_classification=t.a_level;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3') location '${mon_p}/kpi_3';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3')
  select s.primary_classification,
   s.second_level_classification,
   s.mon,
   s.cnt/t.num as num,
   s.asc_code
   from (
   select s.asc_code,s.primary_classification,s.second_level_classification,s.mon,count(*) as cnt from 
   ( 
    select s.asc_code,
    s.primary_classification,
    s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon,
    count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end) 
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by s.asc_code,
    s.vin,
    substr(t.mon_label,1,7),
    s.primary_classification,
    s.second_level_classification
    having count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end)>=2
    ) s group by s.asc_code,s.mon,primary_classification,s.second_level_classification
    ) s ,
    (select * from kpi_b_level_chev_final where kpi='kpi_2_2') t
    where s.asc_code=t.asc_code and s.mon=t.mon and s.primary_classification=t.a_level
    and s.second_level_classification=t.b_level
    ;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3') location '${mon_p}/kpi_3';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3')
  select s.agetype,
   s.mon,
   s.cnt/t.num as num,
   s.asc_code
   from (
   select s.asc_code,s.agetype,s.mon,count(*) as cnt from 
   ( 
    select s.asc_code,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
    s.vin,
    substr(t.mon_label,1,7) as mon,
    count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end) 
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by s.asc_code,
    s.vin,
    substr(t.mon_label,1,7),
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end
    having count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end)>=2
    ) s group by s.asc_code,s.mon,agetype
    ) s ,
    (select * from kpi_agetype_chev_final where kpi='kpi_2_2') t
    where s.asc_code=t.asc_code and s.mon=t.mon and s.agetype=t.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3') location '${mon_p}/kpi_3';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3')
  select s.bn,
   s.mon,
   s.cnt/t.num as num,
   s.asc_code
   from (
   select s.asc_code,s.bn,s.mon,count(*) as cnt from 
   ( 
    select s.asc_code,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon,
    count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end) 
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by s.asc_code,
    s.vin,
    substr(t.mon_label,1,7),
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end 
    having count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end)>=2
    ) s group by s.asc_code,s.mon,bn
    ) s ,
    (select * from kpi_bnbw_chev_final where kpi='kpi_2_2') t
    where s.asc_code=t.asc_code and s.mon=t.mon and s.bn=t.bnbw;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3') location '${mon_p}/kpi_3';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3')
  select s.primary_classification,s.agetype,
   s.mon,
   s.cnt/t.num as num,
   s.asc_code
   from (
   select s.asc_code,s.primary_classification,s.agetype,s.mon,count(*) as cnt from 
   ( 
    select s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
    s.vin,
    substr(t.mon_label,1,7) as mon,
    count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end) 
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by s.asc_code,primary_classification,
    s.vin,
    substr(t.mon_label,1,7),
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end
    having count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end)>=2
    ) s group by s.asc_code,s.mon,agetype,primary_classification
    ) s ,
    (select * from kpi_a_agetype_chev_final where kpi='kpi_2_2') t
    where s.asc_code=t.asc_code and s.mon=t.mon and s.agetype=t.age_type and s.primary_classification=t.a_level;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3') location '${mon_p}/kpi_3';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3')
  select s.primary_classification,s.bn,
   s.mon,
   s.cnt/t.num as num,
   s.asc_code
   from (
   select s.asc_code,s.primary_classification,s.bn,s.mon,count(*) as cnt from 
   ( 
    select s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon,
    count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end) 
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by s.asc_code,primary_classification,
    s.vin,
    substr(t.mon_label,1,7),
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end
    having count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end)>=2
    ) s group by s.asc_code,s.mon,bn,primary_classification
    ) s ,
    (select * from kpi_a_bnbw_chev_final where kpi='kpi_2_2') t
    where s.asc_code=t.asc_code and s.mon=t.mon and s.bn=t.bnbw and s.primary_classification=t.a_level;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3') location '${mon_p}/kpi_3';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3')
  select s.primary_classification,s.second_level_classification,s.agetype,
   s.mon,
   s.cnt/t.num as num,
   s.asc_code
   from (
   select s.asc_code,s.primary_classification,s.second_level_classification,
   s.agetype,s.mon,count(*) as cnt from 
   ( 
    select s.asc_code,primary_classification,s.second_level_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as agetype,
    s.vin,
    substr(t.mon_label,1,7) as mon,
    count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end) 
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by s.asc_code,primary_classification,s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7),
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end
    having count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end)>=2
    ) s group by s.asc_code,s.mon,agetype,primary_classification,s.second_level_classification
    ) s ,
    (select * from kpi_b_agetype_chev_final where kpi='kpi_2_2') t
    where s.asc_code=t.asc_code and s.mon=t.mon and s.agetype=t.age_type and s.primary_classification=t.a_level
    and s.second_level_classification=t.b_level
    ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3') location '${mon_p}/kpi_3';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3')
  select s.primary_classification,s.second_level_classification,s.bn,
   s.mon,
   s.cnt/t.num as num,
   s.asc_code
   from (
   select s.asc_code,s.primary_classification,s.second_level_classification,
   s.bn,s.mon,count(*) as cnt from 
   ( 
    select s.asc_code,primary_classification,s.second_level_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon,
    count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end) 
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    group by s.asc_code,primary_classification,s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7),
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end 
    having count(distinct case when s.MAINT_TYPE1='保养' and  s.order_balance_amount>0 then tran_date(s.order_balance_date) else null end)>=2
    ) s group by s.asc_code,s.mon,bn,primary_classification,s.second_level_classification
    ) s ,
    (select * from kpi_b_bnbw_chev_final where kpi='kpi_2_2') t
    where s.asc_code=t.asc_code and s.mon=t.mon and s.bn=t.bnbw and s.primary_classification=t.a_level
    and s.second_level_classification=t.b_level
    ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_1');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_1') location '${mon_p}/kpi_3_1';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_1')
    select s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon
    group by s.mon,s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_1');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_1') location '${mon_p}/kpi_3_1';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_1')
    select s.primary_classification,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code 
    from (
    select s.asc_code,s.primary_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,s.primary_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.primary_classification=t.primary_classification
    group by s.mon,s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_1');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_1') location '${mon_p}/kpi_3_1';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_1')
  select s.primary_classification,s.second_level_classification,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,s.primary_classification,s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,s.primary_classification,s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification
    group by s.mon,s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_1');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_1') location '${mon_p}/kpi_3_1';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_1')
  select s.age_type,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.age_type=t.age_type
    group by s.mon,s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_1');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_1') location '${mon_p}/kpi_3_1';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_1')
  select s.bn,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
  	when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.bn=t.bn
    group by s.mon,s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_1');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_1') location '${mon_p}/kpi_3_1';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_1')
  select s.primary_classification,s.age_type,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as age_type,
  	s.primary_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon ,
    s.primary_classification
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.age_type=t.age_type and s.primary_classification=t.primary_classification
    group by s.mon,s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_1');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_1') location '${mon_p}/kpi_3_1';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_1')
  select s.primary_classification,s.bn,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.primary_classification,
      s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
  	when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.primary_classification,
      s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.bn=t.bn and s.primary_classification=t.primary_classification
    group by s.mon,s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_1');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_1') location '${mon_p}/kpi_3_1';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_1')
  select s.primary_classification,s.second_level_classification,s.age_type,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as age_type,
  	s.primary_classification,
  	s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon ,
    s.primary_classification,
    s.second_level_classification
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.age_type=t.age_type and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification
    group by s.mon,s.asc_code,s.age_type,s.primary_classification,s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_1');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_1') location '${mon_p}/kpi_3_1';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_1')
  select s.primary_classification,second_level_classification,s.bn,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.primary_classification,s.second_level_classification,
      s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
  	when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.primary_classification,s.second_level_classification,
      s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.bn=t.bn and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification
    group by s.mon,s.asc_code,s.bn,s.primary_classification,s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_12');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_12') location '${mon_p}/kpi_3_12';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_12')
    select s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon
    group by s.mon,s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_12');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_12') location '${mon_p}/kpi_3_12';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_12')
    select s.primary_classification,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,s.primary_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,s.primary_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.primary_classification=t.primary_classification
    group by s.mon,s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_12');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_12') location '${mon_p}/kpi_3_12';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_12')
  select s.primary_classification,s.second_level_classification,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,s.primary_classification,s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,s.primary_classification,s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification
    group by s.mon,s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_12');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_12') location '${mon_p}/kpi_3_12';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_12')
  select s.age_type,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.age_type=t.age_type
    group by s.mon,s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_12');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_12') location '${mon_p}/kpi_3_12';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_12')
  select s.bn,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
  	when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.bn=t.bn
    group by s.mon,s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_12');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_12') location '${mon_p}/kpi_3_12';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_12')
  select s.primary_classification,s.age_type,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as age_type,
  	s.primary_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon ,
    s.primary_classification
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.age_type=t.age_type and s.primary_classification=t.primary_classification
    group by s.mon,s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_12');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_12') location '${mon_p}/kpi_3_12';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_12')
  select s.primary_classification,s.bn,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.primary_classification,
      s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
  	when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.primary_classification,
      s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.bn=t.bn and s.primary_classification=t.primary_classification
    group by s.mon,s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_12');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_12') location '${mon_p}/kpi_3_12';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_12')
  select s.primary_classification,s.second_level_classification,s.age_type,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))<=11 then '0-1年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=12
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '1-2年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=24
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '2-3年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=36
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=47 then '3-4年'
      when mon_diff(t.mon_label,tran_date(s.invoice_date))>=48
      and mon_diff(t.mon_label,tran_date(s.invoice_date))<=59 then '4-5年'
      else '5+年' end as age_type,
  	s.primary_classification,
  	s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon ,
    s.primary_classification,
    s.second_level_classification
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.age_type=t.age_type and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification
    group by s.mon,s.asc_code,s.age_type,s.primary_classification,s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_12');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_12') location '${mon_p}/kpi_3_12';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_12')
  select s.primary_classification,second_level_classification,s.bn,s.mon,
    sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select s.primary_classification,s.second_level_classification,
      s.asc_code,case when tran_date(s.invoice_date)='未知' then '未知'
      when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=23 then '保内'
  	when tran_date(s.invoice_date)<'2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>23 then '保外'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))<=35 then '保内'
  	when tran_date(s.invoice_date)>='2013-10-01' 
  	and mon_diff(t.mon_label,tran_date(s.invoice_date))>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_doss s
    where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.report_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.report_date),1,7)<=substr(t.mon_label,1,7)
    and s.primary_classification<>''
    ) s left join(  
    select distinct s.primary_classification,s.second_level_classification,
      s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon 
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-17),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
    ) t on s.asc_code=t.asc_code and s.vin=t.vin and s.mon=t.mon 
    and s.bn=t.bn and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification
    group by s.mon,s.asc_code,s.bn,s.primary_classification,s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_2');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_2') location '${mon_p}/kpi_3_2';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_2')
  select s.mon,
  sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
  s.asc_code 
   from (
  select distinct s.asc_code,
    s.vin,
    substr(t.mon_label,1,7) as mon
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
  ) s left join (
  select distinct s.asc_code,
    s.vin,
    substr(t.mon_label,1,7) as mon
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    and s.order_balance_amount>0
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin
    group by s.mon,s.asc_code ;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_2');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_2') location '${mon_p}/kpi_3_2';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_2')
    select s.primary_classification,s.mon,
  sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
  s.asc_code 
   from (
  select distinct s.asc_code,s.primary_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
  ) s left join (
  select distinct s.asc_code,s.primary_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    and s.order_balance_amount>0
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin 
    and s.primary_classification=t.primary_classification
    group by s.mon,s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_2');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_2') location '${mon_p}/kpi_3_2';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_2')
   select s.primary_classification,s.second_level_classification,s.mon,
  sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
  s.asc_code 
   from (
  select distinct s.asc_code,s.primary_classification,s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
  ) s left join (
  select distinct s.asc_code,s.primary_classification,s.second_level_classification,
    s.vin,
    substr(t.mon_label,1,7) as mon
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    and s.order_balance_amount>0
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin 
    and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification
    group by s.mon,s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_2');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_2') location '${mon_p}/kpi_3_2';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_2')
  select s.age_type,s.mon,
  sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
  s.asc_code 
   from (
  select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
  ) s left join (
  select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    and s.order_balance_amount>0
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin 
    and s.age_type=t.age_type
    group by s.mon,s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_2');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_2') location '${mon_p}/kpi_3_2';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_2')
  select s.bn,s.mon,
  sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
  s.asc_code 
   from (
  select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
  ) s left join (
  select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    and s.order_balance_amount>0
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin 
    and s.bn=t.bn
    group by s.mon,s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_2');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_2') location '${mon_p}/kpi_3_2';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_2')
  select s.primary_classification,s.age_type,s.mon,
  sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
  s.asc_code 
   from (
  select distinct s.asc_code,s.primary_classification,
      case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
  ) s left join (
  select distinct s.asc_code,s.primary_classification,
      case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    and s.order_balance_amount>0
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin 
    and s.age_type=t.age_type and s.primary_classification=t.primary_classification
    group by s.mon,s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_2');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_2') location '${mon_p}/kpi_3_2';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_2')
  select s.primary_classification,s.bn,s.mon,
  sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
  s.asc_code 
   from (
  select distinct s.asc_code,s.primary_classification,
      case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
  ) s left join (
  select distinct s.asc_code,s.primary_classification,
      case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    and s.order_balance_amount>0
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin 
    and s.bn=t.bn and s.primary_classification=t.primary_classification
    group by s.mon,s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_2');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_2') location '${mon_p}/kpi_3_2';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_2')
  select s.primary_classification,s.second_level_classification,s.age_type,s.mon,
  sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
  s.asc_code 
   from (
  select distinct s.asc_code,s.primary_classification,s.second_level_classification,
      case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
  ) s left join (
  select distinct s.asc_code,s.primary_classification,s.second_level_classification,
      case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    s.vin,
    substr(t.mon_label,1,7) as mon
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    and s.order_balance_amount>0
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin 
    and s.age_type=t.age_type and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification
    group by s.mon,s.asc_code,s.age_type,s.primary_classification,s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_2');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_2') location '${mon_p}/kpi_3_2';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_2')
  select s.primary_classification,s.second_level_classification,s.bn,s.mon,
  sum(case when t.vin is not null then 1 else 0 end)/count(s.vin) as num,
  s.asc_code 
   from (
  select distinct s.asc_code,s.primary_classification,s.second_level_classification,
      case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon
   from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-7),1,7)
    and s.MAINT_TYPE1<>'删除'
    and first_maintnance=1
  ) s left join (
  select distinct s.asc_code,s.primary_classification,s.second_level_classification,
      case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    s.vin,
    substr(t.mon_label,1,7) as mon
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-6),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='保养'
    and s.order_balance_amount>0
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin 
    and s.bn=t.bn and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification
    group by s.mon,s.asc_code,s.bn,s.primary_classification,s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_4');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_4') location '${mon_p}/kpi_3_4';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_4')
   select  
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,maintnance x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_4');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_4') location '${mon_p}/kpi_3_4';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_4')
     select  primary_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,maintnance x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_4');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_4') location '${mon_p}/kpi_3_4';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_4')
     select  primary_classification,second_level_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,maintnance x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_4');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_4') location '${mon_p}/kpi_3_4';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_4')
   select  age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,maintnance x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_4');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_4') location '${mon_p}/kpi_3_4';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_4')
  select  bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,maintnance x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_4');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_4') location '${mon_p}/kpi_3_4';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_4')
  select  primary_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,maintnance x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_4');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_4') location '${mon_p}/kpi_3_4';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_4')
  select  primary_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,maintnance x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_4');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_4') location '${mon_p}/kpi_3_4';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_4')
  select  primary_classification,second_level_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,maintnance x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_4');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_4') location '${mon_p}/kpi_3_4';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_4')
  select  primary_classification,second_level_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,maintnance x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_5');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_5') location '${mon_p}/kpi_3_5';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_5')
   select  
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_5');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_5') location '${mon_p}/kpi_3_5';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_5')
     select  primary_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_5');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_5') location '${mon_p}/kpi_3_5';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_5')
     select  primary_classification,second_level_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_5');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_5') location '${mon_p}/kpi_3_5';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_5')
   select  age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_5');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_5') location '${mon_p}/kpi_3_5';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_5')
  select  bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_5');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_5') location '${mon_p}/kpi_3_5';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_5')
  select  primary_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_5');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_5') location '${mon_p}/kpi_3_5';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_5')
  select  primary_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_5');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_5') location '${mon_p}/kpi_3_5';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_5')
  select  primary_classification,second_level_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_5');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_5') location '${mon_p}/kpi_3_5';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_5')
  select  primary_classification,second_level_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num 
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_51');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_51') location '${mon_p}/kpi_3_51';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_51')
   select  
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='LunT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_51');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_51') location '${mon_p}/kpi_3_51';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_51')
     select  primary_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='LunT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_51');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_51') location '${mon_p}/kpi_3_51';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_51')
     select  primary_classification,second_level_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='LunT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_51');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_51') location '${mon_p}/kpi_3_51';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_51')
   select  age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='LunT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_51');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_51') location '${mon_p}/kpi_3_51';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_51')
  select  bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='LunT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_51');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_51') location '${mon_p}/kpi_3_51';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_51')
  select  primary_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='LunT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_51');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_51') location '${mon_p}/kpi_3_51';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_51')
  select  primary_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='LunT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_51');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_51') location '${mon_p}/kpi_3_51';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_51')
  select  primary_classification,second_level_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='LunT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_51');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_51') location '${mon_p}/kpi_3_51';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_51')
  select  primary_classification,second_level_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='LunT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_52');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_52') location '${mon_p}/kpi_3_52';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_52')
   select  
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='DianC'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_52');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_52') location '${mon_p}/kpi_3_52';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_52')
     select  primary_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='DianC'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_52');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_52') location '${mon_p}/kpi_3_52';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_52')
     select  primary_classification,second_level_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='DianC'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_52');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_52') location '${mon_p}/kpi_3_52';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_52')
   select  age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='DianC'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_52');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_52') location '${mon_p}/kpi_3_52';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_52')
  select  bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='DianC'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_52');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_52') location '${mon_p}/kpi_3_52';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_52')
  select  primary_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='DianC'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_52');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_52') location '${mon_p}/kpi_3_52';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_52')
  select  primary_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='DianC'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_52');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_52') location '${mon_p}/kpi_3_52';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_52')
  select  primary_classification,second_level_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='DianC'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_52');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_52') location '${mon_p}/kpi_3_52';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_52')
  select  primary_classification,second_level_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='DianC'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_53');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_53') location '${mon_p}/kpi_3_53';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_53')
   select  
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type in('DianC','LunT')
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_53');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_53') location '${mon_p}/kpi_3_53';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_53')
     select  primary_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type in('DianC','LunT')
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_53');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_53') location '${mon_p}/kpi_3_53';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_53')
     select  primary_classification,second_level_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type in('DianC','LunT')
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_53');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_53') location '${mon_p}/kpi_3_53';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_53')
   select  age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type in('DianC','LunT')
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_53');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_53') location '${mon_p}/kpi_3_53';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_53')
  select  bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type in('DianC','LunT')
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_53');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_53') location '${mon_p}/kpi_3_53';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_53')
  select  primary_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type in('DianC','LunT')
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_53');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_53') location '${mon_p}/kpi_3_53';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_53')
  select  primary_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type in('DianC','LunT')
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_53');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_53') location '${mon_p}/kpi_3_53';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_53')
  select  primary_classification,second_level_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type in('DianC','LunT')
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_53');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_53') location '${mon_p}/kpi_3_53';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_53')
  select  primary_classification,second_level_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type in('DianC','LunT')
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_54');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_54') location '${mon_p}/kpi_3_54';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_54')
   select  
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='QiT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_54');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_54') location '${mon_p}/kpi_3_54';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_54')
     select  primary_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='QiT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_54');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_54') location '${mon_p}/kpi_3_54';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_54')
     select  primary_classification,second_level_classification,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='QiT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_54');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_54') location '${mon_p}/kpi_3_54';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_54')
   select  age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='QiT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_54');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_54') location '${mon_p}/kpi_3_54';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_54')
  select  bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='QiT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_54');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_54') location '${mon_p}/kpi_3_54';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_54')
  select  primary_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='QiT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_54');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_54') location '${mon_p}/kpi_3_54';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_54')
  select  primary_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='QiT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_54');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_54') location '${mon_p}/kpi_3_54';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_54')
  select  primary_classification,second_level_classification, age_type,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='QiT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,age_type,primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_54');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_54') location '${mon_p}/kpi_3_54';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_54')
  select  primary_classification,second_level_classification, bn,
   substr(tran_date(s.order_balance_date),1,7) as mon,
   count(distinct case when t.asc_code is not null then s.vin else null end)/count(distinct s.vin) as num,
   s.asc_code
   from label_order s 
   left join (
    select distinct t.asc_code,t.order_number from part t ,high_flow_parts x
   where  t.part_number=x.part_num  and x.type='QiT'
     ) t 
    on  s.order_number=t.order_number
    and s.asc_code=t.asc_code
    where substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
    and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
    and s.MAINT_TYPE1<>'删除'
    group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,bn,primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_6');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_6') location '${mon_p}/kpi_3_6';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_6')
   select s.mon,
   (s.num-t.num)/s.num as num,
    s.asc_code
   from 
   (select * from kpi_total_chev_final where kpi='kpi_2_1' and mon>='${begin_date}'
    and mon<='${end_date}') s 
   left join 
   (select * from kpi_total_chev_final where kpi='kpi_2_2' and mon>='${begin_date}'
    and mon<='${end_date}') t
   on s.mon=t.mon and s.asc_code=t.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_6');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_6') location '${mon_p}/kpi_3_6';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_6')
     select 
     s.a_level,
     s.mon,
   (s.num-t.num)/s.num as num,
    s.asc_code
   from 
   (select * from kpi_a_level_chev_final where kpi='kpi_2_1' and mon>='${begin_date}'
    and mon<='${end_date}') s 
   left join 
   (select * from kpi_a_level_chev_final where kpi='kpi_2_2' and mon>='${begin_date}'
    and mon<='${end_date}') t
   on s.mon=t.mon and s.asc_code=t.asc_code and s.a_level=t.a_level;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_6');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_6') location '${mon_p}/kpi_3_6';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_6')
     select 
     s.a_level,
     s.b_level,
     s.mon,
   (s.num-t.num)/s.num as num,
    s.asc_code
   from 
   (select * from kpi_b_level_chev_final where kpi='kpi_2_1' and mon>='${begin_date}'
    and mon<='${end_date}') s 
   left join 
   (select * from kpi_b_level_chev_final where kpi='kpi_2_2' and mon>='${begin_date}'
    and mon<='${end_date}') t
   on s.mon=t.mon and s.asc_code=t.asc_code and s.a_level=t.a_level and s.b_level=t.b_level;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_6');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_6') location '${mon_p}/kpi_3_6';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_6')
    select 
     s.age_type,
     s.mon,
   (s.num-t.num)/s.num as num,
    s.asc_code
   from 
   (select * from kpi_agetype_chev_final where kpi='kpi_2_1' and mon>='${begin_date}'
    and mon<='${end_date}') s 
   left join 
   (select * from kpi_agetype_chev_final where kpi='kpi_2_2' and mon>='${begin_date}'
    and mon<='${end_date}') t
   on s.mon=t.mon and s.asc_code=t.asc_code and s.age_type=t.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_6');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_6') location '${mon_p}/kpi_3_6';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_6')
  select 
     s.bnbw,
     s.mon,
   (s.num-t.num)/s.num as num,
    s.asc_code
   from 
   (select * from kpi_bnbw_chev_final where kpi='kpi_2_1' and mon>='${begin_date}'
    and mon<='${end_date}') s 
   left join 
   (select * from kpi_bnbw_chev_final where kpi='kpi_2_2' and mon>='${begin_date}'
    and mon<='${end_date}') t
   on s.mon=t.mon and s.asc_code=t.asc_code and s.bnbw=t.bnbw;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_6');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_6') location '${mon_p}/kpi_3_6';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_6')
  select
     s.a_level, 
     s.age_type,
     s.mon,
   (s.num-t.num)/s.num as num,
    s.asc_code
   from 
   (select * from kpi_a_agetype_chev_final where kpi='kpi_2_1' and mon>='${begin_date}'
    and mon<='${end_date}') s 
   left join 
   (select * from kpi_a_agetype_chev_final where kpi='kpi_2_2' and mon>='${begin_date}'
    and mon<='${end_date}') t
   on s.mon=t.mon and s.asc_code=t.asc_code and s.age_type=t.age_type and s.a_level=t.a_level;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_6');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_6') location '${mon_p}/kpi_3_6';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_6')
  select
     s.a_level, 
     s.bnbw,
     s.mon,
   (s.num-t.num)/s.num as num,
    s.asc_code
   from 
   (select * from kpi_a_bnbw_chev_final where kpi='kpi_2_1' and mon>='${begin_date}'
    and mon<='${end_date}') s 
   left join 
   (select * from kpi_a_bnbw_chev_final where kpi='kpi_2_2' and mon>='${begin_date}'
    and mon<='${end_date}') t
   on s.mon=t.mon and s.asc_code=t.asc_code and s.bnbw=t.bnbw and s.a_level=t.a_level;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_6');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_6') location '${mon_p}/kpi_3_6';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_6')
  select
     s.a_level,
     s.b_level,
     s.age_type,
     s.mon,
   (s.num-t.num)/s.num as num,
    s.asc_code
   from 
   (select * from kpi_b_agetype_chev_final where kpi='kpi_2_1' and mon>='${begin_date}'
    and mon<='${end_date}') s 
   left join 
   (select * from kpi_b_agetype_chev_final where kpi='kpi_2_2' and mon>='${begin_date}'
    and mon<='${end_date}') t
   on s.mon=t.mon and s.asc_code=t.asc_code and s.age_type=t.age_type and s.a_level=t.a_level and s.b_level=t.b_level;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_6');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_6') location '${mon_p}/kpi_3_6';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_6')
  select
     s.a_level,
     s.b_level,
     s.bnbw,
     s.mon,
   (s.num-t.num)/s.num as num,
    s.asc_code
   from 
   (select * from kpi_b_bnbw_chev_final where kpi='kpi_2_1' and mon>='${begin_date}'
    and mon<='${end_date}') s 
   left join 
   (select * from kpi_b_bnbw_chev_final where kpi='kpi_2_2' and mon>='${begin_date}'
    and mon<='${end_date}') t
   on s.mon=t.mon and s.asc_code=t.asc_code and s.bnbw=t.bnbw and s.a_level=t.a_level and s.b_level=t.b_level;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_61');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_61') location '${mon_p}/kpi_3_61';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_61')
    select s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-12),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin
    group by s.mon,s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_61');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_61') location '${mon_p}/kpi_3_61';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_61')
   select s.primary_classification,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,s.primary_classification,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-12),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,s.primary_classification,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.primary_classification=t.primary_classification and s.vin=t.vin
    group by s.mon,s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_61');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_61') location '${mon_p}/kpi_3_61';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_61')
   select s.primary_classification,s.second_level_classification,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,s.primary_classification,second_level_classification,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-12),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,s.primary_classification,second_level_classification,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon 
    and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification and s.vin=t.vin
    group by s.mon,s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_61');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_61') location '${mon_p}/kpi_3_61';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_61')
    select s.age_type,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-12),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.age_type=t.age_type and s.vin=t.vin
     group by s.mon,s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_61');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_61') location '${mon_p}/kpi_3_61';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_61')
  select s.bn,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-12),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.bn=t.bn and s.vin=t.vin
    group by s.mon,s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_61');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_61') location '${mon_p}/kpi_3_61';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_61')
  select s.primary_classification,s.age_type,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-12),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.age_type=t.age_type 
    and s.primary_classification=t.primary_classification and s.vin=t.vin
    group by s.primary_classification,s.age_type,s.mon,s.asc_code;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_61');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_61') location '${mon_p}/kpi_3_61';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_61')
  select s.primary_classification,s.bn,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-12),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.bn=t.bn
    and s.primary_classification=t.primary_classification and s.vin=t.vin
    group by s.primary_classification,s.bn,s.mon,s.asc_code;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_61');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_61') location '${mon_p}/kpi_3_61';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_61')
  select s.primary_classification,s.second_level_classification,s.age_type,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,primary_classification,second_level_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-12),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,primary_classification,second_level_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.age_type=t.age_type 
    and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification and s.vin=t.vin
    group by s.primary_classification,
    s.second_level_classification,s.age_type,s.mon,s.asc_code;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_61');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_61') location '${mon_p}/kpi_3_61';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_61')
  select s.primary_classification,s.second_level_classification,s.bn,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,primary_classification,second_level_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-12),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,primary_classification,second_level_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.bn=t.bn
    and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification and s.vin=t.vin
    group by s.primary_classification,
    s.second_level_classification,s.bn,s.mon,s.asc_code;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_62');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_62') location '${mon_p}/kpi_3_62';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_62')
    select s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-6),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-5),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.vin=t.vin
    group by s.mon,s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_62');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_62') location '${mon_p}/kpi_3_62';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_62')
   select s.primary_classification,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,s.primary_classification,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-6),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,s.primary_classification,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-5),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon 
    and s.primary_classification=t.primary_classification and s.vin=t.vin
    group by s.primary_classification,s.mon,s.asc_code;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_62');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_62') location '${mon_p}/kpi_3_62';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_62')
   select s.primary_classification,s.second_level_classification,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,s.primary_classification,second_level_classification,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-6),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,s.primary_classification,second_level_classification,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-5),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification and s.vin=t.vin
    group by s.primary_classification,s.second_level_classification,s.mon,s.asc_code;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_62');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_62') location '${mon_p}/kpi_3_62';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_62')
    select s.age_type,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-6),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-5),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.age_type=t.age_type and s.vin=t.vin
    group by s.age_type,s.mon,s.asc_code;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_62');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_62') location '${mon_p}/kpi_3_62';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_62')
  select s.bn,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-6),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-5),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.bn=t.bn and s.vin=t.vin
    group by s.bn,s.mon,s.asc_code;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_62');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_62') location '${mon_p}/kpi_3_62';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_62')
  select s.primary_classification,s.age_type,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-6),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-5),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.age_type=t.age_type 
    and s.primary_classification=t.primary_classification  and s.vin=t.vin
    group by s.primary_classification,s.age_type,s.mon,s.asc_code;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_62');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_62') location '${mon_p}/kpi_3_62';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_62')
  select s.primary_classification,s.bn,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-6),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,primary_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-5),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.bn=t.bn
    and s.primary_classification=t.primary_classification  and s.vin=t.vin
    group by s.primary_classification,s.bn,s.mon,s.asc_code;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_62');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_62') location '${mon_p}/kpi_3_62';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_62')
  select s.primary_classification,s.second_level_classification,s.age_type,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,primary_classification,second_level_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-6),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,primary_classification,second_level_classification,
    case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-5),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.age_type=t.age_type 
    and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification  and s.vin=t.vin
    group by s.primary_classification,
    s.second_level_classification,s.age_type,s.mon,s.asc_code;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_3_62');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_3_62') location '${mon_p}/kpi_3_62';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_3_62')
  select s.primary_classification,s.second_level_classification,s.bn,s.mon,
    sum(case when t.vin is null then 1 else 0 end)/count(s.vin) as num,
    s.asc_code
    from (
    select distinct s.asc_code,primary_classification,second_level_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)=substr(add_months(t.mon_label,-6),1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.order_balance_amount>0
    ) s left join 
    (
    select distinct s.asc_code,primary_classification,second_level_classification,
    case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
    substr(t.mon_label,1,7) as mon,
    s.vin
    from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-5),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    ) t on s.asc_code=t.asc_code and s.mon=t.mon and s.bn=t.bn
    and s.primary_classification=t.primary_classification
    and s.second_level_classification=t.second_level_classification  and s.vin=t.vin
    group by s.primary_classification,s.second_level_classification,s.bn,s.mon,s.asc_code;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0') location '${mon_p}/kpi_0';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_0')
  select substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0') location '${mon_p}/kpi_0';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0')
   select primary_classification,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0') location '${mon_p}/kpi_0';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0')
   select primary_classification,
   second_level_classification,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0') location '${mon_p}/kpi_0';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0')
    select age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0') location '${mon_p}/kpi_0';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0')
  select bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0') location '${mon_p}/kpi_0';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0')
  select primary_classification,
   age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0') location '${mon_p}/kpi_0';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0')
  select primary_classification,
   bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0') location '${mon_p}/kpi_0';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0')
  select primary_classification,
   second_level_classification,
   age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type,
  primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0') location '${mon_p}/kpi_0';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0')
  select primary_classification,
   second_level_classification,
   bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn,
  primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_1');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_1') location '${mon_p}/kpi_0_1';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_1')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.sales_amount) as sumamount,
  s.asc_code
   from  label_order s,part t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_1');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_1') location '${mon_p}/kpi_0_1';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_1')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.sales_amount) as sumamount,
  s.asc_code
   from  label_order s,part t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_1');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_1') location '${mon_p}/kpi_0_1';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_1')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.sales_amount) as sumamount,
  s.asc_code
   from  label_order s,part t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_1');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_1') location '${mon_p}/kpi_0_1';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_1')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.sales_amount) as sumamount,
  s.asc_code
   from  label_order s,part t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_1');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_1') location '${mon_p}/kpi_0_1';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_1')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.sales_amount) as sumamount,
  s.asc_code
   from  label_order s,part t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_1');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_1') location '${mon_p}/kpi_0_1';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_1')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.sales_amount) as sumamount,
  s.asc_code
   from  label_order s,part t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_1');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_1') location '${mon_p}/kpi_0_1';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_1')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.sales_amount) as sumamount,
  s.asc_code
   from  label_order s,part t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_1');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_1') location '${mon_p}/kpi_0_1';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_1')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.sales_amount) as sumamount,
  s.asc_code
   from  label_order s,part t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_1');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_1') location '${mon_p}/kpi_0_1';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_1')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.sales_amount) as sumamount,
  s.asc_code
   from  label_order s,part t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  and substr(tran_date(s.order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(s.order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_2');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_2') location '${mon_p}/kpi_0_2';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_2')
  select substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_2');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_2') location '${mon_p}/kpi_0_2';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_2')
   select primary_classification,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_2');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_2') location '${mon_p}/kpi_0_2';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_2')
   select primary_classification,
   second_level_classification,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_2');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_2') location '${mon_p}/kpi_0_2';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_2')
    select age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_2');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_2') location '${mon_p}/kpi_0_2';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_2')
  select bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_2');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_2') location '${mon_p}/kpi_0_2';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_2')
  select primary_classification,
   age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_2');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_2') location '${mon_p}/kpi_0_2';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_2')
  select primary_classification,
   bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_2');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_2') location '${mon_p}/kpi_0_2';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_2')
  select primary_classification,
   second_level_classification,
   age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type,
  primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_2');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_2') location '${mon_p}/kpi_0_2';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_2')
  select primary_classification,
   second_level_classification,
   bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn,
  primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_3');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_3') location '${mon_p}/kpi_0_3';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_3')
  select substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_3');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_3') location '${mon_p}/kpi_0_3';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_3')
   select primary_classification,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_3');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_3') location '${mon_p}/kpi_0_3';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_3')
   select primary_classification,
   second_level_classification,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_3');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_3') location '${mon_p}/kpi_0_3';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_3')
    select age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_3');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_3') location '${mon_p}/kpi_0_3';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_3')
  select bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_3');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_3') location '${mon_p}/kpi_0_3';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_3')
  select primary_classification,
   age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_3');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_3') location '${mon_p}/kpi_0_3';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_3')
  select primary_classification,
   bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_3');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_3') location '${mon_p}/kpi_0_3';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_3')
  select primary_classification,
   second_level_classification,
   age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type,
  primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_3');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_3') location '${mon_p}/kpi_0_3';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_3')
  select primary_classification,
   second_level_classification,
   bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn,
  primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_4');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_4') location '${mon_p}/kpi_0_4';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_4')
  select substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_4');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_4') location '${mon_p}/kpi_0_4';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_4')
   select primary_classification,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_4');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_4') location '${mon_p}/kpi_0_4';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_4')
   select primary_classification,
   second_level_classification,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_4');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_4') location '${mon_p}/kpi_0_4';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_4')
    select age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_4');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_4') location '${mon_p}/kpi_0_4';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_4')
  select bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_4');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_4') location '${mon_p}/kpi_0_4';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_4')
  select primary_classification,
   age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_4');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_4') location '${mon_p}/kpi_0_4';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_4')
  select primary_classification,
   bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_4');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_4') location '${mon_p}/kpi_0_4';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_4')
  select primary_classification,
   second_level_classification,
   age_type,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,age_type,
  primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_4');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_4') location '${mon_p}/kpi_0_4';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_4')
  select primary_classification,
   second_level_classification,
   bn,
   substr(tran_date(order_balance_date),1,7) as mon,
  sum(order_balance_amount) as sumamount,
  asc_code
   from  label_order  
  where MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(order_balance_date),1,7),asc_code,bn,
  primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_5');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_5') location '${mon_p}/kpi_0_5';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_5')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount) as sumamount,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' 
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_5');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_5') location '${mon_p}/kpi_0_5';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_5')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount) as sumamount,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_5');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_5') location '${mon_p}/kpi_0_5';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_5')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount) as sumamount,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_5');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_5') location '${mon_p}/kpi_0_5';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_5')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount) as sumamount,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_5');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_5') location '${mon_p}/kpi_0_5';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_5')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount) as sumamount,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_5');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_5') location '${mon_p}/kpi_0_5';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_5')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount) as sumamount,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_5');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_5') location '${mon_p}/kpi_0_5';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_5')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount) as sumamount,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_5');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_5') location '${mon_p}/kpi_0_5';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_5')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount) as sumamount,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_0_5');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_0_5') location '${mon_p}/kpi_0_5';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_0_5')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount) as sumamount,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4') location '${mon_p}/kpi_4';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and s.claim=''
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4') location '${mon_p}/kpi_4';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and s.claim=''
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4') location '${mon_p}/kpi_4';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and s.claim=''
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,
  s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4') location '${mon_p}/kpi_4';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and s.claim=''
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4') location '${mon_p}/kpi_4';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and s.claim=''
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4') location '${mon_p}/kpi_4';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and s.claim=''
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4') location '${mon_p}/kpi_4';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and s.claim=''
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4') location '${mon_p}/kpi_4';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and s.claim=''
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4') location '${mon_p}/kpi_4';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1<>'删除'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and s.claim=''
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_1');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_1') location '${mon_p}/kpi_4_1';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_1')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_1');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_1') location '${mon_p}/kpi_4_1';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_1')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_1');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_1') location '${mon_p}/kpi_4_1';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_1')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,
  s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_1');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_1') location '${mon_p}/kpi_4_1';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_1')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_1');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_1') location '${mon_p}/kpi_4_1';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_1')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_1');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_1') location '${mon_p}/kpi_4_1';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_1')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_1');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_1') location '${mon_p}/kpi_4_1';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_1')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_1');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_1') location '${mon_p}/kpi_4_1';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_1')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_1');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_1') location '${mon_p}/kpi_4_1';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_1')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_11');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_11') location '${mon_p}/kpi_4_11';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_11')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='低端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_11');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_11') location '${mon_p}/kpi_4_11';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_11')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='低端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_11');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_11') location '${mon_p}/kpi_4_11';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_11')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='低端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,
  s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_11');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_11') location '${mon_p}/kpi_4_11';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_11')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='低端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_11');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_11') location '${mon_p}/kpi_4_11';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_11')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='低端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_11');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_11') location '${mon_p}/kpi_4_11';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_11')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='低端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_11');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_11') location '${mon_p}/kpi_4_11';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_11')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='低端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_11');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_11') location '${mon_p}/kpi_4_11';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_11')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='低端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_11');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_11') location '${mon_p}/kpi_4_11';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_11')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='低端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_12');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_12') location '${mon_p}/kpi_4_12';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_12')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='中端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_12');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_12') location '${mon_p}/kpi_4_12';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_12')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='中端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_12');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_12') location '${mon_p}/kpi_4_12';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_12')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='中端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,
  s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_12');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_12') location '${mon_p}/kpi_4_12';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_12')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='中端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_12');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_12') location '${mon_p}/kpi_4_12';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_12')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='中端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_12');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_12') location '${mon_p}/kpi_4_12';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_12')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='中端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_12');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_12') location '${mon_p}/kpi_4_12';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_12')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='中端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_12');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_12') location '${mon_p}/kpi_4_12';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_12')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='中端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_12');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_12') location '${mon_p}/kpi_4_12';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_12')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='中端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_13');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_13') location '${mon_p}/kpi_4_13';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_13')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='高端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_13');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_13') location '${mon_p}/kpi_4_13';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_13')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='高端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_13');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_13') location '${mon_p}/kpi_4_13';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_13')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='高端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,
  s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_13');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_13') location '${mon_p}/kpi_4_13';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_13')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='高端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_13');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_13') location '${mon_p}/kpi_4_13';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_13')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='高端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_13');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_13') location '${mon_p}/kpi_4_13';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_13')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='高端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_13');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_13') location '${mon_p}/kpi_4_13';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_13')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='高端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_13');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_13') location '${mon_p}/kpi_4_13';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_13')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='高端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_13');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_13') location '${mon_p}/kpi_4_13';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_13')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s,
  (
  select distinct t.asc_code,t.order_number from part t,engine_oil p
  where t.part_number=p.part_num
  and p.type='高端'
  ) t
  where s.MAINT_TYPE1='保养'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
  and s.asc_code=t.asc_code
  and s.order_number=t.order_number
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_2');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_2') location '${mon_p}/kpi_4_2';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_2')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_2');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_2') location '${mon_p}/kpi_4_2';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_2')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_2');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_2') location '${mon_p}/kpi_4_2';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_2')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,
  s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_2');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_2') location '${mon_p}/kpi_4_2';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_2')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_2');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_2') location '${mon_p}/kpi_4_2';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_2')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_2');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_2') location '${mon_p}/kpi_4_2';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_2')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_2');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_2') location '${mon_p}/kpi_4_2';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_2')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_2');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_2') location '${mon_p}/kpi_4_2';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_2')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_2');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_2') location '${mon_p}/kpi_4_2';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_2')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='维修'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_3');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_3') location '${mon_p}/kpi_4_3';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_3')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_3');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_3') location '${mon_p}/kpi_4_3';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_3')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_3');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_3') location '${mon_p}/kpi_4_3';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_3')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,
  s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_3');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_3') location '${mon_p}/kpi_4_3';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_3')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_3');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_3') location '${mon_p}/kpi_4_3';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_3')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_3');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_3') location '${mon_p}/kpi_4_3';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_3')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_3');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_3') location '${mon_p}/kpi_4_3';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_3')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_3');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_3') location '${mon_p}/kpi_4_3';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_3')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_3');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_3') location '${mon_p}/kpi_4_3';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_3')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(order_balance_amount)/count(distinct vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
  from label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_31');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_31') location '${mon_p}/kpi_4_31';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_31')
  select substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date)
  ) s where sumamount<800
  group by substr(order_balance_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_31');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_31') location '${mon_p}/kpi_4_31';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_31')
  select primary_classification,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification
  ) s where sumamount<800
  group by substr(order_balance_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_31');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_31') location '${mon_p}/kpi_4_31';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_31')
  select primary_classification,
  second_level_classification,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification,
  second_level_classification
  ) s where sumamount<800
  group by substr(order_balance_date,1,7),asc_code,primary_classification,
  second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_31');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_31') location '${mon_p}/kpi_4_31';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_31')
  select age_type,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type
  ) s where sumamount<800
  group by substr(order_balance_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_31');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_31') location '${mon_p}/kpi_4_31';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_31')
  select bn,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn
  ) s where sumamount<800
  group by substr(order_balance_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_31');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_31') location '${mon_p}/kpi_4_31';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_31')
  select primary_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,primary_classification
  ) s where sumamount<800
  group by substr(order_balance_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_31');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_31') location '${mon_p}/kpi_4_31';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_31')
  select primary_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,primary_classification
  ) s where sumamount<800
  group by substr(order_balance_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_31');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_31') location '${mon_p}/kpi_4_31';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_31')
  select primary_classification,
  second_level_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,
  primary_classification,second_level_classification
  ) s where sumamount<800
  group by substr(order_balance_date,1,7),asc_code,age_type,
  primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_31');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_31') location '${mon_p}/kpi_4_31';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_31')
  select primary_classification,
  second_level_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,
  primary_classification,second_level_classification
  ) s where sumamount<800
  group by substr(order_balance_date,1,7),asc_code,bn,
  primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_32');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_32') location '${mon_p}/kpi_4_32';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_32')
  select substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date)
  ) s where sumamount>=800 and sumamount<2000
  group by substr(order_balance_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_32');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_32') location '${mon_p}/kpi_4_32';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_32')
  select primary_classification,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification
  ) s where sumamount>=800 and sumamount<2000
  group by substr(order_balance_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_32');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_32') location '${mon_p}/kpi_4_32';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_32')
  select primary_classification,
  second_level_classification,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification,
  second_level_classification
  ) s where sumamount>=800 and sumamount<2000
  group by substr(order_balance_date,1,7),asc_code,primary_classification,
  second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_32');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_32') location '${mon_p}/kpi_4_32';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_32')
  select age_type,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type
  ) s where sumamount>=800 and sumamount<2000
  group by substr(order_balance_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_32');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_32') location '${mon_p}/kpi_4_32';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_32')
  select bn,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn
  ) s where sumamount>=800 and sumamount<2000
  group by substr(order_balance_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_32');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_32') location '${mon_p}/kpi_4_32';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_32')
  select primary_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,primary_classification
  ) s where sumamount>=800 and sumamount<2000
  group by substr(order_balance_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_32');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_32') location '${mon_p}/kpi_4_32';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_32')
  select primary_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,primary_classification
  ) s where sumamount>=800 and sumamount<2000
  group by substr(order_balance_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_32');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_32') location '${mon_p}/kpi_4_32';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_32')
  select primary_classification,
  second_level_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,
  primary_classification,second_level_classification
  ) s where sumamount>=800 and sumamount<2000
  group by substr(order_balance_date,1,7),asc_code,age_type,
  primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_32');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_32') location '${mon_p}/kpi_4_32';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_32')
  select primary_classification,
  second_level_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,
  primary_classification,second_level_classification
  ) s where sumamount>=800 and sumamount<2000
  group by substr(order_balance_date,1,7),asc_code,bn,
  primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_33');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_33') location '${mon_p}/kpi_4_33';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_33')
  select substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date)
  ) s where sumamount>=2000 and sumamount<5000
  group by substr(order_balance_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_33');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_33') location '${mon_p}/kpi_4_33';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_33')
  select primary_classification,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification
  ) s where sumamount>=2000 and sumamount<5000
  group by substr(order_balance_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_33');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_33') location '${mon_p}/kpi_4_33';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_33')
  select primary_classification,
  second_level_classification,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification,
  second_level_classification
  ) s where sumamount>=2000 and sumamount<5000
  group by substr(order_balance_date,1,7),asc_code,primary_classification,
  second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_33');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_33') location '${mon_p}/kpi_4_33';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_33')
  select age_type,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type
  ) s where sumamount>=2000 and sumamount<5000
  group by substr(order_balance_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_33');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_33') location '${mon_p}/kpi_4_33';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_33')
  select bn,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn
  ) s where sumamount>=2000 and sumamount<5000
  group by substr(order_balance_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_33');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_33') location '${mon_p}/kpi_4_33';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_33')
  select primary_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,primary_classification
  ) s where sumamount>=2000 and sumamount<5000
  group by substr(order_balance_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_33');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_33') location '${mon_p}/kpi_4_33';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_33')
  select primary_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,primary_classification
  ) s where sumamount>=2000 and sumamount<5000
  group by substr(order_balance_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_33');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_33') location '${mon_p}/kpi_4_33';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_33')
  select primary_classification,
  second_level_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,
  primary_classification,second_level_classification
  ) s where sumamount>=2000 and sumamount<5000
  group by substr(order_balance_date,1,7),asc_code,age_type,
  primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_33');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_33') location '${mon_p}/kpi_4_33';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_33')
  select primary_classification,
  second_level_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,
  primary_classification,second_level_classification
  ) s where sumamount>=2000 and sumamount<5000
  group by substr(order_balance_date,1,7),asc_code,bn,
  primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_34');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_34') location '${mon_p}/kpi_4_34';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_34')
  select substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date)
  ) s where sumamount>=5000 and sumamount<10000
  group by substr(order_balance_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_34');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_34') location '${mon_p}/kpi_4_34';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_34')
  select primary_classification,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification
  ) s where sumamount>=5000 and sumamount<10000
  group by substr(order_balance_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_34');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_34') location '${mon_p}/kpi_4_34';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_34')
  select primary_classification,
  second_level_classification,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification,
  second_level_classification
  ) s where sumamount>=5000 and sumamount<10000
  group by substr(order_balance_date,1,7),asc_code,primary_classification,
  second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_34');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_34') location '${mon_p}/kpi_4_34';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_34')
  select age_type,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type
  ) s where sumamount>=5000 and sumamount<10000
  group by substr(order_balance_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_34');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_34') location '${mon_p}/kpi_4_34';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_34')
  select bn,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn
  ) s where sumamount>=5000 and sumamount<10000
  group by substr(order_balance_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_34');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_34') location '${mon_p}/kpi_4_34';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_34')
  select primary_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,primary_classification
  ) s where sumamount>=5000 and sumamount<10000
  group by substr(order_balance_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_34');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_34') location '${mon_p}/kpi_4_34';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_34')
  select primary_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,primary_classification
  ) s where sumamount>=5000 and sumamount<10000
  group by substr(order_balance_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_34');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_34') location '${mon_p}/kpi_4_34';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_34')
  select primary_classification,
  second_level_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,
  primary_classification,second_level_classification
  ) s where sumamount>=5000 and sumamount<10000
  group by substr(order_balance_date,1,7),asc_code,age_type,
  primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_34');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_34') location '${mon_p}/kpi_4_34';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_34')
  select primary_classification,
  second_level_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,
  primary_classification,second_level_classification
  ) s where sumamount>=5000 and sumamount<10000
  group by substr(order_balance_date,1,7),asc_code,bn,
  primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_35');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_35') location '${mon_p}/kpi_4_35';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_35')
  select substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date)
  ) s where sumamount>=10000
  group by substr(order_balance_date,1,7),asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_35');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_35') location '${mon_p}/kpi_4_35';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_35')
  select primary_classification,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification
  ) s where sumamount>=10000
  group by substr(order_balance_date,1,7),asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_35');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_35') location '${mon_p}/kpi_4_35';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_35')
  select primary_classification,
  second_level_classification,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,primary_classification,second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),primary_classification,
  second_level_classification
  ) s where sumamount>=10000
  group by substr(order_balance_date,1,7),asc_code,primary_classification,
  second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_35');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_35') location '${mon_p}/kpi_4_35';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_35')
  select age_type,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type
  ) s where sumamount>=10000
  group by substr(order_balance_date,1,7),asc_code,age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_35');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_35') location '${mon_p}/kpi_4_35';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_35')
  select bn,substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn
  ) s where sumamount>=10000
  group by substr(order_balance_date,1,7),asc_code,bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_35');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_35') location '${mon_p}/kpi_4_35';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_35')
  select primary_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,primary_classification
  ) s where sumamount>=10000
  group by substr(order_balance_date,1,7),asc_code,age_type,primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_35');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_35') location '${mon_p}/kpi_4_35';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_35')
  select primary_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,primary_classification
  ) s where sumamount>=10000
  group by substr(order_balance_date,1,7),asc_code,bn,primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_35');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_35') location '${mon_p}/kpi_4_35';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_35')
  select primary_classification,
  second_level_classification,
  age_type,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,age_type,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),age_type,
  primary_classification,second_level_classification
  ) s where sumamount>=10000
  group by substr(order_balance_date,1,7),asc_code,age_type,
  primary_classification,second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_35');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_35') location '${mon_p}/kpi_4_35';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_35')
  select primary_classification,
  second_level_classification,
  bn,
  substr(order_balance_date,1,7) as mon,
  sum(sumamount)/count(distinct vin,order_balance_date) as num,
  asc_code
  from (
  select s.asc_code,bn,primary_classification,
  second_level_classification,
  s.vin,
  tran_date(order_balance_date) as order_balance_date,
  sum(order_balance_amount) as sumamount 
  from 
  label_order s
  where s.MAINT_TYPE1='事故'
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by s.asc_code,s.vin,tran_date(order_balance_date),bn,
  primary_classification,second_level_classification
  ) s where sumamount>=10000
  group by substr(order_balance_date,1,7),asc_code,bn,
  primary_classification,second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_4');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_4') location '${mon_p}/kpi_4_4';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_4')
  select substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' and t.claim_result in('审核同意','33')
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_4');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_4') location '${mon_p}/kpi_4_4';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_4')
  select s.primary_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' and t.claim_result in('审核同意','33')
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_4');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_4') location '${mon_p}/kpi_4_4';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_4')
  select s.primary_classification,
  s.second_level_classification,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' and t.claim_result in('审核同意','33')
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.primary_classification,s.second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_4');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_4') location '${mon_p}/kpi_4_4';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_4')
  select s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' and t.claim_result in('审核同意','33')
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_4');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_4') location '${mon_p}/kpi_4_4';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_4')
  select s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' and t.claim_result in('审核同意','33')
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_4');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_4') location '${mon_p}/kpi_4_4';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_4')
  select s.primary_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' and t.claim_result in('审核同意','33')
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_4');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_4') location '${mon_p}/kpi_4_4';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_4')
  select s.primary_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' and t.claim_result in('审核同意','33')
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_4');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_4') location '${mon_p}/kpi_4_4';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_4')
  select s.primary_classification,
  s.second_level_classification,
  s.age_type,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' and t.claim_result in('审核同意','33')
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.age_type,s.primary_classification,
  s.second_level_classification;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_4_4');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_4_4') location '${mon_p}/kpi_4_4';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_4_4')
  select s.primary_classification,
  s.second_level_classification,
  s.bn,
  substr(tran_date(s.order_balance_date),1,7) as mon,
  sum(t.claim_accepted_amount)/count(distinct s.vin,tran_date(s.order_balance_date)) as num,
  s.asc_code
   from  label_order s,claim_uniq t 
  where s.MAINT_TYPE1<>'删除'
  and s.asc_code=t.asc_code
  and s.claim_order_number=t.claim_order_number
  and s.claim='1' and t.claim_result in('审核同意','33')
  and substr(tran_date(order_balance_date),1,7)>='${begin_date}'
  and substr(tran_date(order_balance_date),1,7)<='${end_date}'
  group by substr(tran_date(s.order_balance_date),1,7),s.asc_code,s.bn,s.primary_classification,
  s.second_level_classification;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5') location '${mon_p}/kpi_5';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim=''
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1<>'删除'
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5') location '${mon_p}/kpi_5';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim=''
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1<>'删除'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5') location '${mon_p}/kpi_5';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim=''
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1<>'删除'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5') location '${mon_p}/kpi_5';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim=''
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1<>'删除'
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5') location '${mon_p}/kpi_5';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim=''
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1<>'删除'
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5') location '${mon_p}/kpi_5';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim=''
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1<>'删除'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5') location '${mon_p}/kpi_5';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim=''
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1<>'删除'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5') location '${mon_p}/kpi_5';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim=''
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1<>'删除'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5') location '${mon_p}/kpi_5';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim=''
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1<>'删除'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_1');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_1') location '${mon_p}/kpi_5_1';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_1')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_1');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_1') location '${mon_p}/kpi_5_1';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_1')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_1');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_1') location '${mon_p}/kpi_5_1';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_1')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_1');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_1') location '${mon_p}/kpi_5_1';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_1')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_1');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_1') location '${mon_p}/kpi_5_1';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_1')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_1');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_1') location '${mon_p}/kpi_5_1';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_1')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_1');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_1') location '${mon_p}/kpi_5_1';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_1')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_1');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_1') location '${mon_p}/kpi_5_1';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_1')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_1');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_1') location '${mon_p}/kpi_5_1';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_1')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_11');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_11') location '${mon_p}/kpi_5_11';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_11')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='低端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_11');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_11') location '${mon_p}/kpi_5_11';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_11')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='低端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_11');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_11') location '${mon_p}/kpi_5_11';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_11')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='低端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_11');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_11') location '${mon_p}/kpi_5_11';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_11')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='低端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_11');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_11') location '${mon_p}/kpi_5_11';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_11')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='低端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_11');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_11') location '${mon_p}/kpi_5_11';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_11')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='低端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_11');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_11') location '${mon_p}/kpi_5_11';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_11')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='低端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_11');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_11') location '${mon_p}/kpi_5_11';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_11')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='低端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_11');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_11') location '${mon_p}/kpi_5_11';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_11')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='低端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_12');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_12') location '${mon_p}/kpi_5_12';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_12')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='中端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_12');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_12') location '${mon_p}/kpi_5_12';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_12')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='中端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_12');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_12') location '${mon_p}/kpi_5_12';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_12')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='中端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_12');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_12') location '${mon_p}/kpi_5_12';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_12')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='中端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_12');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_12') location '${mon_p}/kpi_5_12';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_12')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='中端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_12');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_12') location '${mon_p}/kpi_5_12';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_12')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='中端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_12');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_12') location '${mon_p}/kpi_5_12';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_12')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='中端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_12');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_12') location '${mon_p}/kpi_5_12';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_12')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='中端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_12');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_12') location '${mon_p}/kpi_5_12';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_12')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='中端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_13');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_13') location '${mon_p}/kpi_5_13';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_13')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='高端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_13');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_13') location '${mon_p}/kpi_5_13';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_13')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='高端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_13');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_13') location '${mon_p}/kpi_5_13';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_13')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='高端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_13');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_13') location '${mon_p}/kpi_5_13';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_13')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='高端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_13');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_13') location '${mon_p}/kpi_5_13';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_13')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='高端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_13');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_13') location '${mon_p}/kpi_5_13';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_13')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='高端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_13');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_13') location '${mon_p}/kpi_5_13';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_13')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='高端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_13');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_13') location '${mon_p}/kpi_5_13';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_13')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='高端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_13');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_13') location '${mon_p}/kpi_5_13';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_13')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,engine_oil y where x.part_number=y.part_num and y.type='高端') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and (s.first_maintnance='' or (s.first_maintnance='1' and s.order_balance_amount<>0))
    and s.MAINT_TYPE1='保养'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_2');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_2') location '${mon_p}/kpi_5_2';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_2')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='维修'
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_2');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_2') location '${mon_p}/kpi_5_2';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_2')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='维修'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_2');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_2') location '${mon_p}/kpi_5_2';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_2')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='维修'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_2');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_2') location '${mon_p}/kpi_5_2';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_2')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='维修'
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_2');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_2') location '${mon_p}/kpi_5_2';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_2')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='维修'
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_2');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_2') location '${mon_p}/kpi_5_2';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_2')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='维修'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_2');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_2') location '${mon_p}/kpi_5_2';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_2')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='维修'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_2');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_2') location '${mon_p}/kpi_5_2';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_2')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='维修'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_2');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_2') location '${mon_p}/kpi_5_2';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_2')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='维修'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_3');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_3') location '${mon_p}/kpi_5_3';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_3')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='事故'
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_3');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_3') location '${mon_p}/kpi_5_3';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_3')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='事故'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_3');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_3') location '${mon_p}/kpi_5_3';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_3')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='事故'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_3');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_3') location '${mon_p}/kpi_5_3';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_3')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='事故'
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_3');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_3') location '${mon_p}/kpi_5_3';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_3')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='事故'
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_3');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_3') location '${mon_p}/kpi_5_3';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_3')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='事故'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_3');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_3') location '${mon_p}/kpi_5_3';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_3')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='事故'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_3');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_3') location '${mon_p}/kpi_5_3';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_3')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='事故'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_3');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_3') location '${mon_p}/kpi_5_3';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_3')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s 
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1='事故'
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_4');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_4') location '${mon_p}/kpi_5_4';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_4')
  select substr(t.mon_label,1,7) as mon,
  sum(m.claim_accepted_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s ,claim_uniq m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim='1' and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.claim_order_number=m.claim_order_number
    and m.claim_result in('审核同意','33')
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_4');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_4') location '${mon_p}/kpi_5_4';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_4')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(m.claim_accepted_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s ,claim_uniq m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim='1' and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.claim_order_number=m.claim_order_number
    and m.claim_result in('审核同意','33')
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_4');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_4') location '${mon_p}/kpi_5_4';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_4')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(m.claim_accepted_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s ,claim_uniq m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim='1' and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.claim_order_number=m.claim_order_number
    and m.claim_result in('审核同意','33')
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_4');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_4') location '${mon_p}/kpi_5_4';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_4')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(m.claim_accepted_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s ,claim_uniq m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim='1' and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.claim_order_number=m.claim_order_number
    and m.claim_result in('审核同意','33')
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_4');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_4') location '${mon_p}/kpi_5_4';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_4')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(m.claim_accepted_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s ,claim_uniq m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim='1' and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.claim_order_number=m.claim_order_number
    and m.claim_result in('审核同意','33')
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_4');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_4') location '${mon_p}/kpi_5_4';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_4')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(m.claim_accepted_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s ,claim_uniq m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim='1' and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.claim_order_number=m.claim_order_number
    and m.claim_result in('审核同意','33')
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_4');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_4') location '${mon_p}/kpi_5_4';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_4')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(m.claim_accepted_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s ,claim_uniq m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim='1' and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.claim_order_number=m.claim_order_number
    and m.claim_result in('审核同意','33')
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_4');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_4') location '${mon_p}/kpi_5_4';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_4')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(m.claim_accepted_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s ,claim_uniq m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim='1' and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.claim_order_number=m.claim_order_number
    and m.claim_result in('审核同意','33')
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_4');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_4') location '${mon_p}/kpi_5_4';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_4')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(m.claim_accepted_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s ,claim_uniq m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.claim='1' and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.claim_order_number=m.claim_order_number
    and m.claim_result in('审核同意','33')
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_5');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_5') location '${mon_p}/kpi_5_5';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_5')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_5');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_5') location '${mon_p}/kpi_5_5';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_5')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_5');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_5') location '${mon_p}/kpi_5_5';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_5')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_5');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_5') location '${mon_p}/kpi_5_5';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_5')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_5');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_5') location '${mon_p}/kpi_5_5';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_5')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_5');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_5') location '${mon_p}/kpi_5_5';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_5')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_5');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_5') location '${mon_p}/kpi_5_5';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_5')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_5');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_5') location '${mon_p}/kpi_5_5';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_5')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_5');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_5') location '${mon_p}/kpi_5_5';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_5')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_51');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_51') location '${mon_p}/kpi_5_51';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_51')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num and y.type='润滑养护') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_51');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_51') location '${mon_p}/kpi_5_51';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_51')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='润滑养护' ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_51');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_51') location '${mon_p}/kpi_5_51';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_51')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='润滑养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_51');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_51') location '${mon_p}/kpi_5_51';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_51')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='润滑养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_51');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_51') location '${mon_p}/kpi_5_51';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_51')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='润滑养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_51');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_51') location '${mon_p}/kpi_5_51';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_51')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='润滑养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_51');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_51') location '${mon_p}/kpi_5_51';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_51')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='润滑养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_51');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_51') location '${mon_p}/kpi_5_51';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_51')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='润滑养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_51');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_51') location '${mon_p}/kpi_5_51';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_51')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='润滑养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_52');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_52') location '${mon_p}/kpi_5_52';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_52')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num and y.type='燃油养护') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_52');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_52') location '${mon_p}/kpi_5_52';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_52')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='燃油养护' ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_52');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_52') location '${mon_p}/kpi_5_52';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_52')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='燃油养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_52');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_52') location '${mon_p}/kpi_5_52';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_52')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='燃油养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_52');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_52') location '${mon_p}/kpi_5_52';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_52')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='燃油养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_52');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_52') location '${mon_p}/kpi_5_52';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_52')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='燃油养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_52');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_52') location '${mon_p}/kpi_5_52';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_52')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='燃油养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_52');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_52') location '${mon_p}/kpi_5_52';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_52')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='燃油养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_52');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_52') location '${mon_p}/kpi_5_52';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_52')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='燃油养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_53');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_53') location '${mon_p}/kpi_5_53';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_53')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num and y.type='节气门养护') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_53');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_53') location '${mon_p}/kpi_5_53';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_53')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='节气门养护' ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_53');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_53') location '${mon_p}/kpi_5_53';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_53')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='节气门养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_53');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_53') location '${mon_p}/kpi_5_53';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_53')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='节气门养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_53');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_53') location '${mon_p}/kpi_5_53';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_53')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='节气门养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_53');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_53') location '${mon_p}/kpi_5_53';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_53')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='节气门养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_53');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_53') location '${mon_p}/kpi_5_53';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_53')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='节气门养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_53');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_53') location '${mon_p}/kpi_5_53';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_53')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='节气门养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_53');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_53') location '${mon_p}/kpi_5_53';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_53')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='节气门养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_54');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_54') location '${mon_p}/kpi_5_54';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_54')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num and y.type='空调养护') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_54');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_54') location '${mon_p}/kpi_5_54';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_54')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='空调养护' ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_54');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_54') location '${mon_p}/kpi_5_54';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_54')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='空调养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_54');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_54') location '${mon_p}/kpi_5_54';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_54')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='空调养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_54');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_54') location '${mon_p}/kpi_5_54';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_54')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='空调养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_54');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_54') location '${mon_p}/kpi_5_54';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_54')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='空调养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_54');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_54') location '${mon_p}/kpi_5_54';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_54')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='空调养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_54');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_54') location '${mon_p}/kpi_5_54';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_54')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='空调养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_54');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_54') location '${mon_p}/kpi_5_54';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_54')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,maintnance y where x.part_number=y.part_num  and y.type='空调养护'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_6');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_6') location '${mon_p}/kpi_5_6';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_6')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num and 1=1) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_6');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_6') location '${mon_p}/kpi_5_6';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_6')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and 1=1 ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_6');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_6') location '${mon_p}/kpi_5_6';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_6')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and 1=1  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_6');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_6') location '${mon_p}/kpi_5_6';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_6')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and 1=1  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_6');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_6') location '${mon_p}/kpi_5_6';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_6')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and 1=1  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_6');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_6') location '${mon_p}/kpi_5_6';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_6')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and 1=1  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_6');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_6') location '${mon_p}/kpi_5_6';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_6')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and 1=1  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_6');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_6') location '${mon_p}/kpi_5_6';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_6')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and 1=1  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_6');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_6') location '${mon_p}/kpi_5_6';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_6')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and 1=1  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_61');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_61') location '${mon_p}/kpi_5_61';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_61')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num and y.type='LunT') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_61');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_61') location '${mon_p}/kpi_5_61';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_61')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='LunT' ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_61');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_61') location '${mon_p}/kpi_5_61';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_61')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='LunT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_61');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_61') location '${mon_p}/kpi_5_61';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_61')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='LunT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_61');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_61') location '${mon_p}/kpi_5_61';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_61')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='LunT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_61');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_61') location '${mon_p}/kpi_5_61';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_61')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='LunT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_61');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_61') location '${mon_p}/kpi_5_61';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_61')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='LunT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_61');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_61') location '${mon_p}/kpi_5_61';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_61')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='LunT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_61');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_61') location '${mon_p}/kpi_5_61';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_61')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='LunT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_62');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_62') location '${mon_p}/kpi_5_62';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_62')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num and y.type='DianC') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_62');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_62') location '${mon_p}/kpi_5_62';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_62')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='DianC' ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_62');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_62') location '${mon_p}/kpi_5_62';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_62')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='DianC'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_62');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_62') location '${mon_p}/kpi_5_62';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_62')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='DianC'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_62');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_62') location '${mon_p}/kpi_5_62';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_62')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='DianC'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_62');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_62') location '${mon_p}/kpi_5_62';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_62')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='DianC'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_62');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_62') location '${mon_p}/kpi_5_62';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_62')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='DianC'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_62');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_62') location '${mon_p}/kpi_5_62';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_62')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='DianC'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_62');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_62') location '${mon_p}/kpi_5_62';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_62')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type='DianC'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_63');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_63') location '${mon_p}/kpi_5_63';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_63')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num and y.type in('DianC','LunT')) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_63');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_63') location '${mon_p}/kpi_5_63';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_63')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type in('DianC','LunT') ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_63');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_63') location '${mon_p}/kpi_5_63';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_63')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type in('DianC','LunT')) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_63');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_63') location '${mon_p}/kpi_5_63';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_63')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type in('DianC','LunT')  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_63');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_63') location '${mon_p}/kpi_5_63';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_63')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type in('DianC','LunT')  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_63');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_63') location '${mon_p}/kpi_5_63';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_63')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type in('DianC','LunT')  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_63');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_63') location '${mon_p}/kpi_5_63';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_63')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type in('DianC','LunT')  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_63');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_63') location '${mon_p}/kpi_5_63';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_63')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type in('DianC','LunT')  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_63');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_63') location '${mon_p}/kpi_5_63';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_63')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type in('DianC','LunT')  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_64');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_64') location '${mon_p}/kpi_5_64';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_64')
  select substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num and y.type ='QiT') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_64');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_64') location '${mon_p}/kpi_5_64';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_64')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type ='QiT' ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_64');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_64') location '${mon_p}/kpi_5_64';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_64')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type ='QiT') m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_64');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_64') location '${mon_p}/kpi_5_64';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_64')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type ='QiT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_64');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_64') location '${mon_p}/kpi_5_64';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_64')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type ='QiT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_64');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_64') location '${mon_p}/kpi_5_64';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_64')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type ='QiT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_64');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_64') location '${mon_p}/kpi_5_64';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_64')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type ='QiT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_64');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_64') location '${mon_p}/kpi_5_64';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_64')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type ='QiT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_64');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_64') location '${mon_p}/kpi_5_64';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_64')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(s.order_balance_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select distinct x.asc_code,x.order_number
   from part x,high_flow_parts y where x.part_number=y.part_num  and y.type ='QiT'  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_total_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_7');
  alter table kpi_total_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_7') location '${mon_p}/kpi_5_7';
  insert overwrite table  kpi_total_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_7')
  select substr(t.mon_label,1,7) as mon,
  sum(m.sales_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select x.asc_code,x.order_number,x.sales_amount
   from part x,enclosure y where x.part_number=y.part_num ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code;

  alter table kpi_a_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_7');
  alter table kpi_a_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_7') location '${mon_p}/kpi_5_7';
  insert overwrite table  kpi_a_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_7')
  select primary_classification,
  substr(t.mon_label,1,7) as mon,
  sum(m.sales_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select x.asc_code,x.order_number,x.sales_amount
   from part x,enclosure y where x.part_number=y.part_num   ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification;

  alter table kpi_b_level_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_7');
  alter table kpi_b_level_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_7') location '${mon_p}/kpi_5_7';
  insert overwrite table  kpi_b_level_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_7')
  select primary_classification,
  second_level_classification,
  substr(t.mon_label,1,7) as mon,
  sum(m.sales_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select x.asc_code,x.order_number,x.sales_amount
   from part x,enclosure y where x.part_number=y.part_num  ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,second_level_classification;

  alter table kpi_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_7');
  alter table kpi_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_7') location '${mon_p}/kpi_5_7';
  insert overwrite table  kpi_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_7')
  select case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(m.sales_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select x.asc_code,x.order_number,x.sales_amount
   from part x,enclosure y where x.part_number=y.part_num    ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_7');
  alter table kpi_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_7') location '${mon_p}/kpi_5_7';
  insert overwrite table  kpi_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_7')
  select case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(m.sales_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select x.asc_code,x.order_number,x.sales_amount
   from part x,enclosure y where x.part_number=y.part_num    ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_a_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_7');
  alter table kpi_a_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_7') location '${mon_p}/kpi_5_7';
  insert overwrite table  kpi_a_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_7')
  select primary_classification,case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(m.sales_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select x.asc_code,x.order_number,x.sales_amount
   from part x,enclosure y where x.part_number=y.part_num    ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_a_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_7');
  alter table kpi_a_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_7') location '${mon_p}/kpi_5_7';
  insert overwrite table  kpi_a_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_7')
  select primary_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(m.sales_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select x.asc_code,x.order_number,x.sales_amount
   from part x,enclosure y where x.part_number=y.part_num    ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

  alter table kpi_b_agetype_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_7');
  alter table kpi_b_agetype_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_7') location '${mon_p}/kpi_5_7';
  insert overwrite table  kpi_b_agetype_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_7')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end as age_type,
  substr(t.mon_label,1,7) as mon,
  sum(m.sales_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select x.asc_code,x.order_number,x.sales_amount
   from part x,enclosure y where x.part_number=y.part_num    ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when mon_diff(t.mon_label,s.outdate)<=11 then '0-1年'
      when mon_diff(t.mon_label,s.outdate)>=12
      and mon_diff(t.mon_label,s.outdate)<=23 then '1-2年'
      when mon_diff(t.mon_label,s.outdate)>=24
      and mon_diff(t.mon_label,s.outdate)<=35 then '2-3年'
      when mon_diff(t.mon_label,s.outdate)>=36
      and mon_diff(t.mon_label,s.outdate)<=47 then '3-4年'
      when mon_diff(t.mon_label,s.outdate)>=48
      and mon_diff(t.mon_label,s.outdate)<=59 then '4-5年'
      else '5+年' end ;

  alter table kpi_b_bnbw_chev_final drop if exists partition(mon_p='${mon_p}',kpi='kpi_5_7');
  alter table kpi_b_bnbw_chev_final add partition (mon_p='${mon_p}',kpi='kpi_5_7') location '${mon_p}/kpi_5_7';
  insert overwrite table  kpi_b_bnbw_chev_final partition(mon_p='${mon_p}',kpi='kpi_5_7')
  select primary_classification,second_level_classification,
  case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end as bn,
  substr(t.mon_label,1,7) as mon,
  sum(m.sales_amount)/count(distinct s.vin) as num,
  s.asc_code
  from date_label t,label_order s,
  (select x.asc_code,x.order_number,x.sales_amount
   from part x,enclosure y where x.part_number=y.part_num    ) m
  where substr(t.mon_label,1,7)>='${begin_date}'
    and substr(t.mon_label,1,7)<='${end_date}'
    and substr(tran_date(s.order_balance_date),1,7)>=substr(add_months(t.mon_label,-11),1,7)
    and substr(tran_date(s.order_balance_date),1,7)<=substr(t.mon_label,1,7)
    and s.MAINT_TYPE1<>'删除'
    and s.asc_code=m.asc_code
    and s.order_number=m.order_number
   group by substr(t.mon_label,1,7),s.asc_code,primary_classification,
   second_level_classification,
   case when s.outdate='未知' then '未知'
      when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=23 then '保内'
  	when s.outdate<'2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>23 then '保外'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)<=35 then '保内'
  	when s.outdate>='2013-10-01' 
  	and mon_diff(t.mon_label,s.outdate)>35 then '保外'
  	else '' end ;

" >../log/2200621 2>&1 
